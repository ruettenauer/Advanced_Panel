[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Advanced Panel Data Analysis",
    "section": "",
    "text": "Course Description\nThis course provides a hands-on introduction to advanced panel data methods. It briefly covers the basic concepts of random effects (RE) and fixed effects (FE) estimators. Moving beyond the fundamentals, the workshop offers insights into recent developments and advances in panel data methods, such as the inclusion of individual or group-specific slopes and the identification of time-varying treatment effects via impact functions and novel Diff-in-Diff estimators.\n\n\nCourse Outline\nIntro Panel Data\nPanel Data Estimators 1\n\nVariance Decomposition\nFixed Effects\nDifference in Differences\nRandom Effects\n\nPanel Data Estimators 2\n\nDynamic treatment effects\nDynamic Diff-in-Diff\nFixed Effects Individual Slopes"
  },
  {
    "objectID": "02_Estimators1.html#age-and-happiness",
    "href": "02_Estimators1.html#age-and-happiness",
    "title": "Panel Data Estimators 1",
    "section": "Age and happiness",
    "text": "Age and happiness\nLet’s clarify the idea and advantage of panel data with an example.\nAssume we want to know the relationship between age (as our independent variable) and happiness (as our dependent variable), and we have data on 24 observations.\n\n\nCode\n################################\n### Example 1: Age happiness ###\n################################\n\nset.seed(213)\n\n### Data simulation program\nsimdata &lt;- function(N = 6, T = 4,\n                    age_range = c(20:60), \n                    u_sd = 0.2, uw_sd = 0){\n  \n  # id and wave\n  df &lt;- data.frame(matrix(NA, ncol = 2, nrow = N*T))\n  names(df) &lt;- c(\"id\", \"time\")\n  \n  df$id &lt;- rep(1:N, each = T)\n  df$time &lt;- rep(1:T, times = N)\n  df$idname &lt;- factor(df$id, levels = c(1:N), labels = paste(\"Person\", c(1:N)))\n  \n  # age\n  startingage &lt;- age_range\n  startingage &lt;- round(quantile(startingage, probs = seq(0, 1, 1/(N-1))), 0)\n  df$age &lt;- unname(rep(startingage, each = T)) + df$time*2\n  \n  # cohort \n  df$cohort &lt;- 0\n  df$cohort[(N*T/2 + 1):(N*T)] &lt;- 1\n  df$cohort &lt;- factor(df$cohort, levels = c(0, 1), \n                      labels = c(\"Younger cohort\", \"Older cohort\"))\n  \n  # demeaned age\n  df$dm_age &lt;- df$age - ave(df$age, df$id, FUN = function(x) mean(x)) \n  \n  # Personal intercept\n  df$intercept &lt;- 5 + 0.5 * df$id\n  \n  # Overall error\n  u &lt;- rnorm(N*T, mean = 0, sd = u_sd)\n  \n  # Additional within error\n  uw &lt;- unlist(lapply(1:N, function(x) rnorm(T, mean = 0, sd = uw_sd)))\n  \n  # Gen happiness\n  y &lt;- 1 + 0.05 * df$age - 0.2 * df$dm_age + 2 * as.numeric(df$cohort) + u + uw\n  df$happiness &lt;- y\n  \n  # Gen person means\n  df$m_age &lt;- ave(df$age, df$id, FUN = function(x) mean(x)) \n  df$m_happiness &lt;- ave(df$happiness, df$id, FUN = function(x) mean(x)) \n  \n  return(df)\n}\n\n### Set up six individuals with age and happiness\nN &lt;- 6\nT &lt;- 4\n\ndf &lt;- simdata(N = N, T = T)\n\n\n# Total line for plot\nlm1 &lt;- lm(happiness ~ age, data = df)\nlm2 &lt;- lm(happiness ~ age + cohort, data = df)\nlm3 &lt;- lm(happiness ~ age + idname, data = df)\nlm4 &lt;- lm(m_happiness ~ m_age, data = df)"
  },
  {
    "objectID": "02_Estimators1.html#age-and-happiness-1",
    "href": "02_Estimators1.html#age-and-happiness-1",
    "title": "Panel Data Estimators 1",
    "section": "Age and happiness",
    "text": "Age and happiness\n\n\nCode\nzp0 &lt;- ggplot(df, aes(age, happiness)) +\n  geom_point( aes(x = age, y = happiness), size = 2, stroke = 1) +\n  ylim(3.3, 9.2) + expand_limits(y = c(0, 0)) + \n  theme_classic() +\n  theme(legend.key = element_blank(), legend.title = element_blank(),\n        legend.position = c(0.95,0.05), legend.justification = c(\"right\", \"bottom\"),\n        legend.background = element_blank(),\n        legend.box.background = element_rect(colour = \"black\"))\nzp0"
  },
  {
    "objectID": "02_Estimators1.html#cross-sectional-setting",
    "href": "02_Estimators1.html#cross-sectional-setting",
    "title": "Panel Data Estimators 1",
    "section": "Cross-sectional setting",
    "text": "Cross-sectional setting\nIn a cross-sectional setting, we could just run a standard linear regression model using Omitted Least Squares (OLS) of the form\n\\[\ny_{i} = \\alpha + \\beta_1 x_{i} + \\upsilon_{i},\n\\]\nwhere \\(y_{i}\\) is the dependent variable (happiness) and \\(x_i\\) the independent variable of each observation \\(i \\in \\{1, \\dots, 24\\}\\). \\(\\beta_1\\) is the coefficient of interest, \\(\\alpha\\) the overall intercept and \\(\\upsilon_{i}\\) the error term."
  },
  {
    "objectID": "02_Estimators1.html#cross-sectional-setting-1",
    "href": "02_Estimators1.html#cross-sectional-setting-1",
    "title": "Panel Data Estimators 1",
    "section": "Cross-sectional setting",
    "text": "Cross-sectional setting\n\nlm1 &lt;- lm(happiness ~ age, data = df)\nsummary(lm1)\n\n\nCall:\nlm(formula = happiness ~ age, data = df)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1.4964 -0.4209 -0.1201  0.6615  1.6868 \n\nCoefficients:\n            Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)   1.0506     0.5696   1.844   0.0787 .  \nage           0.1151     0.0121   9.515 2.96e-09 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.8206 on 22 degrees of freedom\nMultiple R-squared:  0.8045,    Adjusted R-squared:  0.7956 \nF-statistic: 90.53 on 1 and 22 DF,  p-value: 2.96e-09"
  },
  {
    "objectID": "02_Estimators1.html#cross-sectional-setting-2",
    "href": "02_Estimators1.html#cross-sectional-setting-2",
    "title": "Panel Data Estimators 1",
    "section": "Cross-sectional setting",
    "text": "Cross-sectional setting\n\n\nCode\n# The palette with black:\ncbp2 &lt;- c(\"#000000\", \n          \"#E69F00\", \n          \"#56B4E9\", \n          \"#009E73\",\n          \"#F0E442\", \n          \"#0072B2\", \n          \"#D55E00\", \n          \"#CC79A7\")\n\n# Save the residual values\ndf$predicted &lt;- predict(lm1)\ndf$residuals &lt;- residuals(lm1)\n\nzp1 &lt;- ggplot(df, aes(age, happiness)) +\n  geom_point( aes(x = age, y = happiness), size = 2, stroke = 1) +\n  geom_smooth(method = 'lm', formula = y ~ x, se = FALSE, color  = \"deeppink\") +\n  geom_segment(data = df, aes(xend = age, yend = predicted), \n               alpha = .3, color = \"purple\") +\n  ylim(3.3, 9.2) + expand_limits(y = c(0, 0)) + \n  theme_classic() +\n  theme(legend.key = element_blank(), legend.title = element_blank(),\n        legend.position = c(0.95,0.05), legend.justification = c(\"right\", \"bottom\"),\n        legend.background = element_blank(),\n        legend.box.background = element_rect(colour = \"black\"))\nzp1"
  },
  {
    "objectID": "02_Estimators1.html#adding-controls",
    "href": "02_Estimators1.html#adding-controls",
    "title": "Panel Data Estimators 1",
    "section": "Adding controls",
    "text": "Adding controls\nBirth cohort might be a potential confounder that affects age and happiness. We would then estimate the model\n\\[\ny_{i} = \\alpha + \\beta_1 x_{i} + \\beta_2 z_{it} + \\upsilon_{i},\n\\]\nwhere \\(z_i\\) is the control variable or confounder (cohort)."
  },
  {
    "objectID": "02_Estimators1.html#adding-controls-1",
    "href": "02_Estimators1.html#adding-controls-1",
    "title": "Panel Data Estimators 1",
    "section": "Adding controls",
    "text": "Adding controls\n\nlm2 &lt;- lm(happiness ~ age + cohort, data = df)\nsummary(lm2)\n\n\nCall:\nlm(formula = happiness ~ age + cohort, data = df)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.01188 -0.35012 -0.01682  0.31611  0.92289 \n\nCoefficients:\n                   Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)         3.32191    0.52030   6.385 2.50e-06 ***\nage                 0.03687    0.01512   2.439   0.0237 *  \ncohortOlder cohort  2.49959    0.41862   5.971 6.31e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.5114 on 21 degrees of freedom\nMultiple R-squared:  0.9275,    Adjusted R-squared:  0.9206 \nF-statistic: 134.4 on 2 and 21 DF,  p-value: 1.075e-12"
  },
  {
    "objectID": "02_Estimators1.html#adding-controls-2",
    "href": "02_Estimators1.html#adding-controls-2",
    "title": "Panel Data Estimators 1",
    "section": "Adding controls",
    "text": "Adding controls\n\n\nCode\n# Save the residual values\nfor(i in unique(df$cohort)){\n  oo &lt;- which(df$cohort == i)\n  lmt &lt;- lm(happiness ~ age, data = df[oo, ])\n  df$predicted[oo] &lt;- predict(lmt)\n  df$residuals[oo] &lt;- residuals(lmt)\n}\n\n\nzp2 &lt;- ggplot(df, aes(age, happiness)) +\n  geom_point(aes(x = age, y = happiness, shape = cohort, colour = cohort), \n              size = 2, stroke = 1) +\n  geom_smooth(method = 'lm', formula = y ~ x, se = FALSE, show.legend = FALSE,\n              mapping = aes(colour = cohort, linetype = cohort)) +  \n  geom_segment(data = df, aes(xend = age, yend = predicted), \n               alpha = .3, color = \"purple\") +\n  geom_abline(intercept = lm2$coefficients[1] + 0.5 * lm2$coefficients[3], \n                               slope = lm2$coefficients[2], color  = \"deeppink\") +  \n  ylim(3.3, 9.2) + expand_limits(y = c(0, 0)) + \n  scale_colour_manual(values = cbp2[-c(1, 2)]) + \n  scale_fill_manual(values = cbp2[-c(1, 2)]) + \n  scale_shape_manual(values = c(15:18, 25, 20)) +\n  theme_classic() +\n  theme(legend.key = element_blank(), legend.title = element_blank(),\n        legend.position = c(0.95,0.05), legend.justification = c(\"right\", \"bottom\"),\n        legend.background = element_blank(),\n        legend.box.background = element_rect(colour = \"black\"))\nzp2"
  },
  {
    "objectID": "02_Estimators1.html#panel-data-setting",
    "href": "02_Estimators1.html#panel-data-setting",
    "title": "Panel Data Estimators 1",
    "section": "Panel data setting",
    "text": "Panel data setting\nNow, with panel data, we can even go a step further. Assume we would not have observed 24 independent observations, but rather 6 independent individuals (N = 6) at 4 time-points each (T = 4).\n\n\nCode\nzp3 &lt;- ggplot(df, aes(age, happiness)) +\n  geom_point( aes(x = age, y = happiness, shape = idname, colour = idname, fill = idname), \n              size = 2, stroke = 1) +\n  ylim(3.3, 9.2) + expand_limits(y = c(0, 0)) + \n  scale_colour_manual(values = cbp2[-c(1, 2)]) + \n  scale_fill_manual(values = cbp2[-c(1, 2)]) + \n  scale_shape_manual(values = c(15:18, 25, 20)) +\n  theme_classic() +\n  theme(legend.key = element_blank(), legend.title = element_blank(),\n        legend.position = c(0.95,0.05), legend.justification = c(\"right\", \"bottom\"),\n        legend.background = element_blank(),\n        legend.box.background = element_rect(colour = \"black\"))\nzp3"
  },
  {
    "objectID": "02_Estimators1.html#panel-data-setting-1",
    "href": "02_Estimators1.html#panel-data-setting-1",
    "title": "Panel Data Estimators 1",
    "section": "Panel data setting",
    "text": "Panel data setting\nWe can then decompose the available variance into three different parts:\n\nPooled variance\nBetween variance\nWithin variance"
  },
  {
    "objectID": "02_Estimators1.html#pooled-estimator",
    "href": "02_Estimators1.html#pooled-estimator",
    "title": "Panel Data Estimators 1",
    "section": "Pooled estimator",
    "text": "Pooled estimator\nThe pooled estimator equals what we have seen in the cross-sectional example: we basically assume that we have 24 independent observations and we ignore the person and time dimension. The Pooled OLS estimator is simply:\n\\[\ny_{it} = \\alpha + \\beta_{POLS} x_{it} + \\upsilon_{it},\n\\]\n\nlm1 &lt;- lm(happiness ~ age, data = df)\nsummary(lm1)"
  },
  {
    "objectID": "02_Estimators1.html#pooled-estimator-1",
    "href": "02_Estimators1.html#pooled-estimator-1",
    "title": "Panel Data Estimators 1",
    "section": "Pooled estimator",
    "text": "Pooled estimator\n\n\nCode\n# Save the residual values\ndf$predicted &lt;- predict(lm1)\ndf$residuals &lt;- residuals(lm1)\n\nzp3 &lt;- ggplot(df, aes(age, happiness)) +\n  geom_point( aes(x = age, y = happiness, shape = idname, colour = idname, fill = idname), \n              size = 2, stroke = 1) +\n  geom_smooth(method = 'lm', formula = y ~ x, se = FALSE,\n              color  = \"deeppink\") +\n  geom_segment(aes(xend = age, yend = predicted), \n               alpha = .3, color = \"purple\") +\n  annotate(\"text\", x = 35, y = 8.0, \n           label = paste0(\"beta[Pooled] ==\", round(lm1$coefficients[2], 3)), \n           parse = TRUE) +\n  ylim(3.3, 9.2) + expand_limits(y = c(0, 0)) + \n  scale_colour_manual(values = cbp2[-c(1, 2)]) + \n  scale_fill_manual(values = cbp2[-c(1, 2)]) + \n  scale_shape_manual(values = c(15:18, 25, 20)) +\n  ggtitle(\"A) Pooled Estimate\") +\n  theme_classic() +\n  theme(legend.key = element_blank(), \n        legend.title = element_blank(),\n        text = element_text(size = 14),\n        legend.position = c(0.95,0.05), \n        legend.justification = c(\"right\", \"bottom\"),\n        legend.background = element_blank(),\n        legend.box.background = element_rect(colour = \"black\"))\nzp3"
  },
  {
    "objectID": "02_Estimators1.html#between-estimator",
    "href": "02_Estimators1.html#between-estimator",
    "title": "Panel Data Estimators 1",
    "section": "Between estimator",
    "text": "Between estimator\nThe between estimator only compares different persons and discards the within-person variance. Therefore, we simply run a model that only uses the person-specific means\n\\[\n\\bar{y_{i}} = \\alpha + \\beta_{BTW} \\bar{x_{i}} + \\bar{\\upsilon_{i}},\n\\]\nwhere \\(\\bar{y_{i}}\\) and \\(\\bar{x_{i}}\\) are the unit-specific means of \\(x_{it}\\) and \\(y_{it}\\), respectively."
  },
  {
    "objectID": "02_Estimators1.html#between-estimator-1",
    "href": "02_Estimators1.html#between-estimator-1",
    "title": "Panel Data Estimators 1",
    "section": "Between estimator",
    "text": "Between estimator\nWe can either estimate this by hand:\n\ndf$m_happiness &lt;- ave(df$happiness, df$id, FUN = mean)\ndf$m_age &lt;- ave(df$age, df$id, FUN = mean)\n\nlm2 &lt;- lm(m_happiness ~ m_age, data = df)\nsummary(lm2)"
  },
  {
    "objectID": "02_Estimators1.html#between-estimator-2",
    "href": "02_Estimators1.html#between-estimator-2",
    "title": "Panel Data Estimators 1",
    "section": "Between estimator",
    "text": "Between estimator\nor we use the plm package to do the job for us\n\nbtw2 &lt;- plm(happiness ~ age, data = df,\n           index = c(\"id\", \"time\"),\n           effect = \"individual\", model = \"between\")\nsummary(btw2)\n\nOneway (individual) effect Between Model\n\nCall:\nplm(formula = happiness ~ age, data = df, effect = \"individual\", \n    model = \"between\", index = c(\"id\", \"time\"))\n\nBalanced Panel: n = 6, T = 4, N = 24\nObservations used in estimation: 6\n\nResiduals:\n        1         2         3         4         5         6 \n 0.254242 -0.158370 -0.774367  0.831689  0.021989 -0.175184 \n\nCoefficients:\n            Estimate Std. Error t-value Pr(&gt;|t|)   \n(Intercept) 0.733095   0.834979  0.8780 0.429528   \nage         0.122176   0.017755  6.8813 0.002337 **\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nTotal Sum of Squares:    18.13\nResidual Sum of Squares: 1.4122\nR-Squared:      0.92211\nAdj. R-Squared: 0.90263\nF-statistic: 47.3519 on 1 and 4 DF, p-value: 0.0023371"
  },
  {
    "objectID": "02_Estimators1.html#between-estimator-3",
    "href": "02_Estimators1.html#between-estimator-3",
    "title": "Panel Data Estimators 1",
    "section": "Between estimator",
    "text": "Between estimator\n\n\nCode\ndf2 &lt;- df\ndf2$happiness &lt;- df2$m_happiness\ndf2$age &lt;- df2$m_age\ndf2 &lt;- df2[which(df2$time == 1), ]\n\n# Save the residual values\nlm4 &lt;- lm(m_happiness ~ m_age, data = df2)\ndf2$predicted &lt;- predict(lm4)\ndf2$residuals &lt;- residuals(lm4)\n\nzp4 &lt;- ggplot(df, aes(age, happiness)) +\n  geom_point(aes(x = age, y = happiness, shape = idname), \n              size = 2, stroke = 1, colour = alpha(\"black\", .3), fill = alpha(\"black\", .3)) +\n  geom_point(aes(x = m_age, y = m_happiness, shape = idname, colour = idname,\n                 fill = idname), \n             size = 2, stroke = 1) +\n  geom_smooth(data = df2, \n              method = 'lm', formula = y ~ x, se = FALSE,\n              color  = \"deeppink\") +\n  geom_segment(data = df2, aes(xend = age, yend = predicted), \n               alpha = .3, color = \"purple\") +\n  annotate(\"text\", x = 35, y = 8.0, \n           label = paste0(\"beta[Between] ==\", round(lm4$coefficients[2], 3)), \n           parse = TRUE) +\n  ylim(3.3, 9.2) + expand_limits(y = c(0, 0)) + \n  scale_colour_manual(values = cbp2[-c(1, 2)]) + \n  scale_fill_manual(values = cbp2[-c(1, 2)]) + \n  scale_shape_manual(values = c(15:18, 25, 20)) +\n  ggtitle(\"B) Between Estimate\") +\n  theme_classic() +\n  theme(legend.key = element_blank(), \n        legend.title = element_blank(),\n        text = element_text(size = 14),\n        legend.position = c(0.95,0.05), \n        legend.justification = c(\"right\", \"bottom\"),\n        legend.background = element_blank(),\n        legend.box.background = element_rect(colour = \"black\"))\n\nzp4"
  },
  {
    "objectID": "02_Estimators1.html#within-estimator",
    "href": "02_Estimators1.html#within-estimator",
    "title": "Panel Data Estimators 1",
    "section": "Within estimator",
    "text": "Within estimator\nThe within estimator only compares different periods within the same person and discards the between-person variance. We could also say the estimator is solely based on changes over time.\n\\[\ny_{it} = \\alpha_i + \\beta_{WI} x_{it} + \\epsilon_{it},\n\\]\nTo achieve this, we simply give every person their own intercept \\(\\alpha_i\\): we add a dummy for each person."
  },
  {
    "objectID": "02_Estimators1.html#within-estimator-1",
    "href": "02_Estimators1.html#within-estimator-1",
    "title": "Panel Data Estimators 1",
    "section": "Within estimator",
    "text": "Within estimator\nAgain, we could run this manually\n\nlm3 &lt;- lm(happiness ~ age + idname, data = df)\nsummary(lm3)\n\nMake sure idname is a factor. Otherwise use as.factor(idname)."
  },
  {
    "objectID": "02_Estimators1.html#within-estimator-2",
    "href": "02_Estimators1.html#within-estimator-2",
    "title": "Panel Data Estimators 1",
    "section": "Within estimator",
    "text": "Within estimator\nor we use plm:\n\nfe1 &lt;- plm(happiness ~ age, data = df,\n           index = c(\"id\", \"time\"),\n           effect = \"individual\", model = \"within\")\nsummary(fe1)\n\n\nFormula and Data"
  },
  {
    "objectID": "02_Estimators1.html#within-estimator-3",
    "href": "02_Estimators1.html#within-estimator-3",
    "title": "Panel Data Estimators 1",
    "section": "Within estimator",
    "text": "Within estimator\nor we use plm:\n\nfe1 &lt;- plm(happiness ~ age, data = df,\n           index = c(\"id\", \"time\"),\n           effect = \"individual\", model = \"within\")\nsummary(fe1)\n\n\nDefine id and time columns"
  },
  {
    "objectID": "02_Estimators1.html#within-estimator-4",
    "href": "02_Estimators1.html#within-estimator-4",
    "title": "Panel Data Estimators 1",
    "section": "Within estimator",
    "text": "Within estimator\nor we use plm:\n\nfe1 &lt;- plm(happiness ~ age, data = df,\n           index = c(\"id\", \"time\"),\n           effect = \"individual\", model = \"within\")\nsummary(fe1)\n\n\neffect: Define the type of fixed effects (individual, time, twoways)\nmodel: Define the estimator (within for FE)"
  },
  {
    "objectID": "02_Estimators1.html#within-estimator-5",
    "href": "02_Estimators1.html#within-estimator-5",
    "title": "Panel Data Estimators 1",
    "section": "Within estimator",
    "text": "Within estimator\nor we use plm:\n\nfe1 &lt;- plm(happiness ~ age, data = df,\n           index = c(\"id\", \"time\"),\n           effect = \"individual\", model = \"within\")\nsummary(fe1)\n\nOneway (individual) effect Within Model\n\nCall:\nplm(formula = happiness ~ age, data = df, effect = \"individual\", \n    model = \"within\", index = c(\"id\", \"time\"))\n\nBalanced Panel: n = 6, T = 4, N = 24\n\nResiduals:\n     Min.   1st Qu.    Median   3rd Qu.      Max. \n-0.287907 -0.118754  0.035834  0.141721  0.275941 \n\nCoefficients:\n     Estimate Std. Error t-value  Pr(&gt;|t|)    \nage -0.148245   0.017418 -8.5108 1.556e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nTotal Sum of Squares:    3.2561\nResidual Sum of Squares: 0.61893\nR-Squared:      0.80992\nAdj. R-Squared: 0.74283\nF-statistic: 72.4345 on 1 and 17 DF, p-value: 1.5556e-07"
  },
  {
    "objectID": "02_Estimators1.html#within-estimator-6",
    "href": "02_Estimators1.html#within-estimator-6",
    "title": "Panel Data Estimators 1",
    "section": "Within estimator",
    "text": "Within estimator\n\n\nCode\ndf2 &lt;- df\ndf2$happiness &lt;- df2$happiness - df2$m_happiness + mean(df$happiness)\ndf2$age &lt;- df2$age - df2$m_age  + mean(df$age)\n\n# Save the residual values\nfor(i in unique(df$id)){\n  oo &lt;- which(df$id == i)\n  lmt &lt;- lm(happiness ~ age, data = df[oo, ])\n  df$predicted[oo] &lt;- predict(lmt)\n  df$residuals[oo] &lt;- residuals(lmt)\n}\n\n\nzp5 &lt;- ggplot(df, aes(age, happiness)) +\n  geom_point( aes(x = age, y = happiness, shape = idname, colour = idname, fill  = idname), \n              size = 2, stroke = 1) +\n  geom_smooth(method = 'lm', formula = y ~ x, se = FALSE, show.legend = FALSE,\n              mapping = aes(group = idname),\n              color  = \"deeppink\", linetype = \"dotted\") +\n  geom_smooth(method = 'lm', formula = y ~ x, se = FALSE, show.legend = FALSE,\n              data = df2, color  = \"deeppink\", fullrange = TRUE) +\n  geom_segment(data = df, aes(xend = age, yend = predicted), \n               alpha = .3, color = \"purple\") +\n  annotate(\"text\", x = 35, y = 8.0, \n           label = paste0(\"beta[Within] ==\", round(lm3$coefficients[2], 3)), \n           parse = TRUE) +\n  ylim(3.3, 9.2) + expand_limits(y = c(0, 0)) + \n  scale_fill_manual(values = cbp2[-c(1, 2)]) +\n  scale_colour_manual(values = cbp2[-c(1, 2)]) + \n  scale_shape_manual(values = c(15:18, 25, 20)) +\n  ggtitle(\"C) Within Estimate / Fixed Effects\") +\n  theme_classic() +\n  theme(legend.key = element_blank(), \n        legend.title = element_blank(),\n        text = element_text(size = 14),\n        legend.position = c(0.95,0.05), \n        legend.justification = c(\"right\", \"bottom\"),\n        legend.background = element_blank(),\n        legend.box.background = element_rect(colour = \"black\"))\n\nzp5"
  },
  {
    "objectID": "02_Estimators1.html#comparison",
    "href": "02_Estimators1.html#comparison",
    "title": "Panel Data Estimators 1",
    "section": "Comparison",
    "text": "Comparison\n\nlibrary(\"texreg\")\nscreenreg(list(lm1, lm2, lm3), digits = 3, \n          custom.model.names = c(\"POLS\", \"Between\", \"Within\"))\n\n\n==================================================\n                POLS        Between     Within    \n--------------------------------------------------\n(Intercept)      1.051       0.733       7.748 ***\n                (0.570)     (0.356)     (0.446)   \nage              0.115 ***              -0.148 ***\n                (0.012)                 (0.017)   \nm_age                        0.122 ***            \n                            (0.008)               \nidnamePerson 2                           1.751 ***\n                                        (0.194)   \nidnamePerson 3                           3.298 ***\n                                        (0.310)   \nidnamePerson 4                           7.068 ***\n                                        (0.439)   \nidnamePerson 5                           8.421 ***\n                                        (0.573)   \nidnamePerson 6                          10.387 ***\n                                        (0.710)   \n--------------------------------------------------\nR^2              0.805       0.922       0.992    \nAdj. R^2         0.796       0.919       0.989    \nNum. obs.       24          24          24        \n==================================================\n*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05"
  },
  {
    "objectID": "02_Estimators1.html#comparison-1",
    "href": "02_Estimators1.html#comparison-1",
    "title": "Panel Data Estimators 1",
    "section": "Comparison",
    "text": "Comparison"
  },
  {
    "objectID": "02_Estimators1.html#fe-faster-estimation",
    "href": "02_Estimators1.html#fe-faster-estimation",
    "title": "Panel Data Estimators 1",
    "section": "FE: Faster estimation",
    "text": "FE: Faster estimation\nOften faster than plm: felm() in package lfe\nParticularly, with large data, group-specific interactions, or when you want clustered standard error, this can save you time."
  },
  {
    "objectID": "02_Estimators1.html#fe-faster-estimation-1",
    "href": "02_Estimators1.html#fe-faster-estimation-1",
    "title": "Panel Data Estimators 1",
    "section": "FE: Faster estimation",
    "text": "FE: Faster estimation\nOften faster than plm: felm() in package lfe\n\nlibrary(lfe)\nfe1_alt &lt;- felm(happiness ~ age | id | 0 | id,\n                data = df)\nsummary(fe1_alt)\n\nFour-part formula:\n\nFormula: 1) ordinary covariates, 2) fixed effects, 3) Instrumental Variables, 4) Cluster for SEs\ny ~ x1 + x2 | f1 + f2 | (Q|W ~ x3+x4) | clu1 + clu2\nCan include interactions between FEs: y ~ x1 + x | x:f + f"
  },
  {
    "objectID": "02_Estimators1.html#fe-faster-estimation-2",
    "href": "02_Estimators1.html#fe-faster-estimation-2",
    "title": "Panel Data Estimators 1",
    "section": "FE: Faster estimation",
    "text": "FE: Faster estimation\nOften faster than plm: felm() in package lfe\n\nlibrary(lfe)\nfe1_alt &lt;- felm(happiness ~ age | id | 0 | id,\n                data = df)\nsummary(fe1_alt)\n\n\nCall:\n   felm(formula = happiness ~ age | id | 0 | id, data = df) \n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.28791 -0.11875  0.03583  0.14172  0.27594 \n\nCoefficients:\n    Estimate Cluster s.e. t value Pr(&gt;|t|)    \nage -0.14824      0.01711  -8.665 0.000338 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1908 on 17 degrees of freedom\nMultiple R-squared(full model): 0.9918   Adjusted R-squared: 0.9889 \nMultiple R-squared(proj model): 0.8099   Adjusted R-squared: 0.7428 \nF-statistic(full model, *iid*):344.1 on 6 and 17 DF, p-value: &lt; 2.2e-16 \nF-statistic(proj model): 75.08 on 1 and 5 DF, p-value: 0.0003384"
  },
  {
    "objectID": "02_Estimators1.html#assumption-for-conistency-of-pols",
    "href": "02_Estimators1.html#assumption-for-conistency-of-pols",
    "title": "Panel Data Estimators 1",
    "section": "Assumption for conistency of POLS",
    "text": "Assumption for conistency of POLS\nThe POLS\n\\[\ny_{it} = \\alpha + \\beta x_{it} + \\upsilon_{it}\n\\]\nrelies on very strong assumptions for consistency, most importantly: The error (including omitted variables) must not be correlated with \\(x_{it}\\).\n\n\\(\\mathrm{E}(\\upsilon_{it} | x_{it}) = 0\\), or \\(Cov(x_{it}, \\upsilon_{it}) = 0\\)"
  },
  {
    "objectID": "02_Estimators1.html#marriage-and-income",
    "href": "02_Estimators1.html#marriage-and-income",
    "title": "Panel Data Estimators 1",
    "section": "Marriage and income",
    "text": "Marriage and income\nImagine we want to know how getting married affects a persons happiness or their income. POLS (and the between estimator) compare people who eventually get married to people who never get married.\nWhat could potentially go wrong?"
  },
  {
    "objectID": "02_Estimators1.html#one-way-fixed-effects",
    "href": "02_Estimators1.html#one-way-fixed-effects",
    "title": "Panel Data Estimators 1",
    "section": "One-way fixed effects",
    "text": "One-way fixed effects\nTo relax the strong assumption, we can decompose the error into two parts (between and within) and split up our main assumption for consistency:\n\n\\(\\mathrm{E}(\\alpha_{i} | x_{it}) = 0\\): No time-constant unobserved heterogeneity\n\\(\\mathrm{E}(\\epsilon_{it} | x_{it}) = 0\\): No time-varying unobserved heterogeneity"
  },
  {
    "objectID": "02_Estimators1.html#one-way-fixed-effects-1",
    "href": "02_Estimators1.html#one-way-fixed-effects-1",
    "title": "Panel Data Estimators 1",
    "section": "One-way fixed effects",
    "text": "One-way fixed effects\nThe FE\n\\[\ny_{it} = \\beta x_{it} + \\alpha_i + \\epsilon_{it}\n\\]\nincludes unit-specific fixed effects to account for the first type of heterogeneity. The most basic way of including person-specific dummy variable is called Least Square Dummy variable (LSDV) approach.\nSee e.g. Wooldridge (2010) or Bruderl.2015."
  },
  {
    "objectID": "02_Estimators1.html#one-way-fixed-effects-2",
    "href": "02_Estimators1.html#one-way-fixed-effects-2",
    "title": "Panel Data Estimators 1",
    "section": "One-way fixed effects",
    "text": "One-way fixed effects\nIn practice, we usually use a transformation approach, where we first subtract the between variance by using use the person-specific means:\n\\[\n\\begin{split}\ny_{it} - \\bar{y_{i}} &= \\beta (x_{it}-\\bar{x_{i}}) + (\\alpha_i - \\alpha_i) + (\\epsilon_{it}-\\bar{\\epsilon_{i}})\\\\\n\\tilde{y}_{it} &= \\beta \\tilde{x}_{it} + \\tilde{\\epsilon}_{it}.\n\\end{split}\n\\]"
  },
  {
    "objectID": "02_Estimators1.html#one-way-fixed-effects-3",
    "href": "02_Estimators1.html#one-way-fixed-effects-3",
    "title": "Panel Data Estimators 1",
    "section": "One-way fixed effects",
    "text": "One-way fixed effects\nThe main assumption for consistency now is\n\n\\(\\mathrm{E}(\\epsilon_{it} | x_{it}, \\alpha_i) = 0\\)\n\nIdiosyncratic time-variation in \\(\\epsilon_{it}\\) (including time trends in \\(y\\)) must be uncorrelated with variation in \\(x_{it}\\) across all time periods. However, \\(\\mathrm{E}(\\alpha_{i} | x_{i})\\) can be any function of \\(x_i\\).\n\nTime-constant unobserved heterogeneity is allowed\nOnly time-varying unobserved heterogeneity biases the estimator"
  },
  {
    "objectID": "02_Estimators1.html#would-one-way-fe-get-it-right",
    "href": "02_Estimators1.html#would-one-way-fe-get-it-right",
    "title": "Panel Data Estimators 1",
    "section": "Would one-way FE get it right?",
    "text": "Would one-way FE get it right?\n\n\nCode\n##################################\n### Example 2: Marriage Income ###\n##################################\n\n### Set up six individuals with age and happiness\nN &lt;- 4\nT &lt;- 6\n\n# id and wave\ndf2 &lt;- data.frame(matrix(NA, ncol = 2, nrow = N*T))\nnames(df2) &lt;- c(\"id\", \"time\")\n\ndf2$id &lt;- rep(1:N, each = T)\ndf2$time &lt;- rep(1:T, times = N)\ndf2$idname &lt;- factor(df2$id, levels = c(1:N), labels = paste(\"Person\", c(1:N)))\n\n# Marriage dummy\ndf2$marriage_ever &lt;- 0 \ndf2$marriage_ever[(N*T/2 + 1):(N*T)] &lt;- 1\n\ndf2$marriage &lt;- df2$marriage_ever * ifelse(df2$time &gt;= 4, 1, 0)\n\n# Starting wage\nstw &lt;- c(2000, 5000)\nstw &lt;- round(quantile(stw, probs = seq(0, 1, 1/(N-1))), 0)\n\n# wage equation\ndf2$wage &lt;- unname(rep(stw, each = T)) + (df2$time - 1)*50 + 200 * ifelse(df2$time &gt;=4, 1, 0) + df2$marriage * 500\n\n# counterfactual parallel trend\ndf2$pti &lt;- unname(rep(stw, each = T)) + (df2$time - 1)*50 \ndf2$pt &lt;- unname(rep(stw, each = T)) + (df2$time - 1)*50 + 200 * ifelse(df2$time &gt;=4, 1, 0) \ndf2$pti[df2$marriage_ever == 0 | df2$time &lt; 3] &lt;- NA\ndf2$pt[df2$marriage_ever == 0 | df2$time &lt; 3] &lt;- NA\n\n\n### Add individual slope / heterogeneous time trends\n\n# wage equation\ndf2$wage2 &lt;- unname(rep(stw, each = T)) + (df2$time - 1)*50  + (df2$time - 1)*150*df2$marriage_ever + 200 * ifelse(df2$time &gt;=4, 1, 0) + df2$marriage * 500\n\n# parallel trend\ndf2$pt2 &lt;- unname(rep(stw, each = T)) + (df2$time - 1)*50 + 200 * ifelse(df2$time &gt;=4, 1, 0) + 2*150\ndf2$pt2[df2$marriage_ever == 0 | df2$time &lt; 3] &lt;- NA\n\n# actual trend\ndf2$pt2_cr &lt;- unname(rep(stw, each = T)) + (df2$time - 1)*50 + (df2$time - 1)*150*df2$marriage_ever + 200 * ifelse(df2$time &gt;=4, 1, 0)\ndf2$pt2_cr[df2$marriage_ever == 0 | df2$time &lt; 3] &lt;- NA\n\n# Marry to factor\ndf2$marriage &lt;- factor(df2$marriage, levels = c(0, 1), labels = c(\"not married\", \"married\"))\ndf2$marriage_ever &lt;- as.factor(df2$marriage_ever)\n\n\n### Plot \nzp1 &lt;- ggplot(df2, aes(time, wage)) +\n  geom_line(aes(x = time, y = wage, group = id), lty = \"solid\", colour = \"black\", lwd = 1) + \n  geom_point( aes(x = time, y = wage, shape = marriage, fill = marriage), \n             size = 4, stroke = 1.5, color = \"white\") +\n  theme_classic() +\n  scale_shape_manual(values = c(21, 24)) +\n  scale_fill_manual(values = c(\"#85144b\", \"#0074D9\")) +\n  scale_color_manual(values = c(\"#85144b\", \"#0074D9\")) +\n  theme(legend.key = element_blank(), legend.title = element_blank(),\n        legend.position = c(0.05,0.95), legend.justification = c(\"left\", \"top\"),\n        legend.background = element_blank(),\n        legend.box.background = element_rect(colour = \"black\"),\n        legend.spacing.y = unit(-0.1, \"cm\"))\nzp1"
  },
  {
    "objectID": "02_Estimators1.html#would-one-way-fe-get-it-right-1",
    "href": "02_Estimators1.html#would-one-way-fe-get-it-right-1",
    "title": "Panel Data Estimators 1",
    "section": "Would one-way FE get it right?",
    "text": "Would one-way FE get it right?\n\nfe2 &lt;- plm(wage ~ marriage, data = df2,\n           index = c(\"id\", \"time\"),\n           effect = \"individual\", model = \"within\")\nsummary(fe2)\n\nOneway (individual) effect Within Model\n\nCall:\nplm(formula = wage ~ marriage, data = df2, effect = \"individual\", \n    model = \"within\", index = c(\"id\", \"time\"))\n\nBalanced Panel: n = 4, T = 6, N = 24\n\nResiduals:\n   Min. 1st Qu.  Median 3rd Qu.    Max. \n-225.00  -68.75    0.00   68.75  225.00 \n\nCoefficients:\n                Estimate Std. Error t-value  Pr(&gt;|t|)    \nmarriagemarried  850.000     84.552  10.053 4.834e-09 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nTotal Sum of Squares:    2575000\nResidual Sum of Squares: 407500\nR-Squared:      0.84175\nAdj. R-Squared: 0.80843\nF-statistic: 101.061 on 1 and 19 DF, p-value: 4.8337e-09"
  },
  {
    "objectID": "02_Estimators1.html#would-one-way-fe-get-it-right-2",
    "href": "02_Estimators1.html#would-one-way-fe-get-it-right-2",
    "title": "Panel Data Estimators 1",
    "section": "Would one-way FE get it right?",
    "text": "Would one-way FE get it right?\nFE is based on within-unit variance.\n\n\n\n\n\n\nNote\n\n\nA one-ways FE would effectively drop all those observations without within-variance on the independent variables. In our case, we would disregard those who never marry.\n\n\n\nHowever, the never married also experienced an increase in wages when the other two married."
  },
  {
    "objectID": "02_Estimators1.html#would-one-way-fe-get-it-right-3",
    "href": "02_Estimators1.html#would-one-way-fe-get-it-right-3",
    "title": "Panel Data Estimators 1",
    "section": "Would one-way FE get it right?",
    "text": "Would one-way FE get it right?\n\n\nCode\n### Plot \nzp3 &lt;- ggplot(df2, aes(time, wage)) +\n  geom_line(aes(x = time, y = wage, group = id, alpha = marriage_ever), lty = \"solid\", colour = \"black\", lwd = 1) + \n  geom_point( aes(x = time, y = wage, shape = marriage, fill = marriage, alpha = marriage_ever), \n              size = 4, stroke = 1.5, color = \"white\") +\n  geom_line(aes(x = time, y = pti, group = id, linetype = \"dashed\"), colour = \"blue\", lwd = 1) +\n  scale_linetype_identity(labels = \"Counterfactual\", guide = \"legend\") +\n  scale_alpha_manual(values = c(0.5, 1), guide = \"none\") +\n  # geom_mark_hull(data = df2[df2$marriage_ever == 1, ], aes(x = time, y = wage, fill = marriage),\n  #                expand = 0.01, show.legend = FALSE, colour = NA) + \n  theme_classic() +\n  scale_shape_manual(values = c(21, 24)) +\n  scale_fill_manual(values = c(\"#85144b\", \"#0074D9\")) +\n  scale_color_manual(values = c(\"#85144b\", \"#0074D9\")) +\n  theme(legend.key = element_blank(), legend.title = element_blank(),\n        legend.position = c(0.05,0.95), legend.justification = c(\"left\", \"top\"),\n        legend.background = element_blank(),\n        legend.box.background = element_rect(colour = \"black\"),\n        legend.spacing.y = unit(-0.1, \"cm\"))\nzp3"
  },
  {
    "objectID": "02_Estimators1.html#two-ways-fe",
    "href": "02_Estimators1.html#two-ways-fe",
    "title": "Panel Data Estimators 1",
    "section": "Two-ways FE",
    "text": "Two-ways FE\nTo circumvent the problem above, we want to add the never-married as a control group in our estimator.\n\n\n\n\n\n\nTip\n\n\nIn general, it is always a good idea to control for temporal shocks!"
  },
  {
    "objectID": "02_Estimators1.html#two-ways-fe-1",
    "href": "02_Estimators1.html#two-ways-fe-1",
    "title": "Panel Data Estimators 1",
    "section": "Two-ways FE",
    "text": "Two-ways FE\nThe two-way FE\n\\[\ny_{it} = \\beta x_{it} + \\alpha_i + \\zeta_t + \\epsilon_{it},\n\\]\nadds \\(\\zeta_t\\), with are time fixed effects. Analogous to \\(\\alpha_i\\), we could just add a dummy variable for each year / time period in the data.\nThis removes common time shocks independent of treatment, and takes back in individuals without variation in \\(x\\). We basically add a ‘control-group’ to the estimation."
  },
  {
    "objectID": "02_Estimators1.html#two-ways-fe-2",
    "href": "02_Estimators1.html#two-ways-fe-2",
    "title": "Panel Data Estimators 1",
    "section": "Two-ways FE",
    "text": "Two-ways FE\nIn practice, we usually use a transformation approach, where we subtract the between variance by using the person-specific & time-specific means:\n\\[\n\\begin{split}\n(y_{it} - \\bar{y}_i  - \\bar{y}_t + \\bar{y}) = \\beta (x_{it} - \\bar{x}_i - \\bar{x}_t + \\bar{x}) \\\\ + (\\epsilon_{it} - \\bar{\\epsilon}_i  - \\bar{\\epsilon}_t + \\bar{\\epsilon}).\n\\end{split}\n\\]"
  },
  {
    "objectID": "02_Estimators1.html#two-ways-fe-3",
    "href": "02_Estimators1.html#two-ways-fe-3",
    "title": "Panel Data Estimators 1",
    "section": "Two-ways FE",
    "text": "Two-ways FE\nWe can just change the effect option in plm to “twoways” to achieve this:\n\nfe3 &lt;- plm(wage ~ marriage, data = df2,\n           index = c(\"id\", \"time\"),\n           effect = \"twoways\", model = \"within\")\nsummary(fe3)"
  },
  {
    "objectID": "02_Estimators1.html#two-ways-fe-4",
    "href": "02_Estimators1.html#two-ways-fe-4",
    "title": "Panel Data Estimators 1",
    "section": "Two-ways FE",
    "text": "Two-ways FE\nOr we add another factor variable in `felm’:\n\nfe3_alt &lt;- felm(wage ~ marriage | id + as.factor(time) | 0 | id,\n                data = df2)\nsummary(fe3_alt)\n\n\nCall:\n   felm(formula = wage ~ marriage | id + as.factor(time) | 0 | id,      data = df2) \n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-2.842e-14 -2.842e-14  0.000e+00  2.842e-14  2.842e-14 \n\nCoefficients:\n                 Estimate Cluster s.e.  t value Pr(&gt;|t|)    \nmarriagemarried 5.000e+02    6.711e-14 7.45e+15   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 3.721e-14 on 14 degrees of freedom\nMultiple R-squared(full model):     1   Adjusted R-squared:     1 \nMultiple R-squared(proj model):     1   Adjusted R-squared:     1 \nF-statistic(full model, *iid*):3.125e+33 on 9 and 14 DF, p-value: &lt; 2.2e-16 \nF-statistic(proj model): 5.551e+31 on 1 and 3 DF, p-value: &lt; 2.2e-16"
  },
  {
    "objectID": "02_Estimators1.html#two-ways-fe-5",
    "href": "02_Estimators1.html#two-ways-fe-5",
    "title": "Panel Data Estimators 1",
    "section": "Two-ways FE",
    "text": "Two-ways FE\n\n\nCode\n### Plot \nzp4 &lt;- ggplot(df2, aes(time, wage)) +\n  geom_line(aes(x = time, y = wage, group = id), lty = \"solid\", colour = \"black\", lwd = 1) + \n  geom_point( aes(x = time, y = wage, shape = marriage, fill = marriage), \n              size = 4, stroke = 1.5, color = \"white\") +\n  geom_line(aes(x = time, y = pt, group = id, linetype = \"dashed\"), colour = \"blue\", lwd = 1) +\n  scale_linetype_identity(labels = \"Counterfactual\", guide = \"legend\") +\n  theme_classic() +\n  scale_shape_manual(values = c(21, 24)) +\n  scale_fill_manual(values = c(\"#85144b\", \"#0074D9\")) +\n  scale_color_manual(values = c(\"#85144b\", \"#0074D9\")) +\n  theme(legend.key = element_blank(), legend.title = element_blank(),\n        legend.position = c(0.05,0.95), legend.justification = c(\"left\", \"top\"),\n        legend.background = element_blank(),\n        legend.box.background = element_rect(colour = \"black\"),\n        legend.spacing.y = unit(-0.1, \"cm\"))\nzp4"
  },
  {
    "objectID": "02_Estimators1.html#a-very-critical-assumption",
    "href": "02_Estimators1.html#a-very-critical-assumption",
    "title": "Panel Data Estimators 1",
    "section": "A very critical assumption",
    "text": "A very critical assumption\nIn the example above, the twoways FE model works very well. However, adding the control group back in comes with a strong assumption:\nParallel trends between “treatment” and “control” units\nComparing the 3 waves before the treatment above, this assumption here holds. Both - those who marry and those who never marry - have the same time trend in wages before the “treated” marry."
  },
  {
    "objectID": "02_Estimators1.html#a-very-critical-assumption-1",
    "href": "02_Estimators1.html#a-very-critical-assumption-1",
    "title": "Panel Data Estimators 1",
    "section": "A very critical assumption",
    "text": "A very critical assumption\n\n\nCode\nzp5 &lt;- ggplot(df2, aes(time, wage2)) +\n  geom_line(aes(x = time, y = wage2, group = id), lty = \"solid\", colour = \"black\", lwd = 1) + \n  geom_point( aes(x = time, y = wage2, shape = marriage, fill = marriage), \n              size = 4, stroke = 1.5, color = \"white\") +\n  # geom_line(aes(x = time, y = pt2, group = id, linetype = \"dashed\"), colour = \"blue\", lwd = 1) +\n  # geom_line(aes(x = time, y = pt2_cr, group = id, linetype = \"dashed\"), colour = \"grey\", lwd = 1, show.legend = FALSE, alpha = 0.7) +\n  scale_linetype_identity(labels = \"Counterfactual\", guide = \"legend\") +\n  # scale_alpha_manual(values = c(0.3, 1), guide = \"none\") +\n  # ylim(3.3, 9.2) + expand_limits(y = c(0, 0)) + \n  theme_classic() +\n  scale_shape_manual(values = c(21, 24)) +\n  scale_fill_manual(values = c(\"#85144b\", \"#0074D9\")) +\n  scale_color_manual(values = c(\"#85144b\", \"#0074D9\")) +\n  ylab(\"wage\") +\n  theme(legend.key = element_blank(), legend.title = element_blank(),\n        legend.position = c(0.05,0.95), legend.justification = c(\"left\", \"top\"),\n        legend.background = element_blank(),\n        legend.box.background = element_rect(colour = \"black\"),\n        legend.spacing.y = unit(-0.1, \"cm\"))\nzp5"
  },
  {
    "objectID": "02_Estimators1.html#a-very-critical-assumption-2",
    "href": "02_Estimators1.html#a-very-critical-assumption-2",
    "title": "Panel Data Estimators 1",
    "section": "A very critical assumption",
    "text": "A very critical assumption\n\nfe3 &lt;- plm(wage2 ~ marriage, data = df2,\n           index = c(\"id\", \"time\"),\n           effect = \"twoways\", model = \"within\")\nsummary(fe3)\n\nTwoways effects Within Model\n\nCall:\nplm(formula = wage2 ~ marriage, data = df2, effect = \"twoways\", \n    model = \"within\", index = c(\"id\", \"time\"))\n\nBalanced Panel: n = 4, T = 6, N = 24\n\nResiduals:\n   Min. 1st Qu.  Median 3rd Qu.    Max. \n    -75     -75       0      75      75 \n\nCoefficients:\n                Estimate Std. Error t-value  Pr(&gt;|t|)    \nmarriagemarried  950.000     65.465  14.511 7.881e-10 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nTotal Sum of Squares:    1443800\nResidual Sum of Squares: 90000\nR-Squared:      0.93766\nAdj. R-Squared: 0.89759\nF-statistic: 210.583 on 1 and 14 DF, p-value: 7.8808e-10"
  },
  {
    "objectID": "02_Estimators1.html#difference-in-differences-1",
    "href": "02_Estimators1.html#difference-in-differences-1",
    "title": "Panel Data Estimators 1",
    "section": "Difference in Differences",
    "text": "Difference in Differences\nThe difference-in-differences (DD) design is a very basic and popular design to identify causal treatment effects in a panel data setting.\nThe most basic setting, is a \\(2\\times 2\\) DD estimator. It consists of a setting where we have 2 groups: a treatment group (\\(T\\)) and control group (\\(C\\)). Each group has been observed at 2 time points: before treatment (\\(pre\\)) and after treatment (\\(post\\)).\nSee Cunningham (2021) and Huntington-Klein (2021)."
  },
  {
    "objectID": "02_Estimators1.html#difference-in-differences-2",
    "href": "02_Estimators1.html#difference-in-differences-2",
    "title": "Panel Data Estimators 1",
    "section": "Difference in Differences",
    "text": "Difference in Differences\nIn this setting we can calculate the change in the treatment group: \\[\n\\mathrm{E}(\\Delta y_{T}) = \\mathrm{E}(y_{T}^{post}) - \\mathrm{E}(y_{T}^{pre}),\n\\]\nand likewise in the control group: \\[\n\\mathrm{E}(\\Delta y_{C}) = \\mathrm{E}(y_{C}^{post}) - \\mathrm{E}(y_{C}^{pre}).\n\\]\nThe simple DD estimator is then the difference between the differences in the treatment group and the differences in the control group:\n\\[\n\\hat{\\delta}_{DD} = \\mathrm{E}(\\Delta y_{T}) - \\mathrm{E}(\\Delta y_{C}) = (\\mathrm{E}(y_{T}^{post}) - \\mathrm{E}(y_{T}^{pre})) - (\\mathrm{E}(y_{C}^{post}) - \\mathrm{E}(y_{C}^{pre})).\n\\]"
  },
  {
    "objectID": "02_Estimators1.html#difference-in-differences-3",
    "href": "02_Estimators1.html#difference-in-differences-3",
    "title": "Panel Data Estimators 1",
    "section": "Difference in Differences",
    "text": "Difference in Differences\n\nDiff-in-Diff design, adopted from Cunningham (2021)"
  },
  {
    "objectID": "02_Estimators1.html#difference-in-differences-4",
    "href": "02_Estimators1.html#difference-in-differences-4",
    "title": "Panel Data Estimators 1",
    "section": "Difference in Differences",
    "text": "Difference in Differences\nThe DID\n\\[\ny_{it} = \\alpha + \\gamma D_{i} + \\lambda Post_{t} + \\delta_{DD} (D_{i} \\times Post_{t}) + \\upsilon_{it}.\n\\]\nis the same estimator in a simple regression, \\(D \\in {0, 1}\\) is a binary indicator of the treatment group and \\(Post \\in {0, 1}\\) a binary indicator of pre- or post-treatment period."
  },
  {
    "objectID": "02_Estimators1.html#difference-in-differences-5",
    "href": "02_Estimators1.html#difference-in-differences-5",
    "title": "Panel Data Estimators 1",
    "section": "Difference in Differences",
    "text": "Difference in Differences\nThe DID\n\\[\ny_{it} = \\alpha + \\gamma D_{i} + \\lambda Post_{t} + \\delta_{DD} (D_{i} \\times Post_{t}) + \\upsilon_{it}.\n\\]\n\n\\(\\alpha\\): average outcome of control group in pre-treatment period\n\\(\\gamma\\): average difference between treatment and control group in pre-treatment period\n\\(\\lambda\\): average difference between post- pre-treatment period in control group\n\\(\\delta_{DD}\\): difference between treatment and control group in difference between post- pre-treatment period"
  },
  {
    "objectID": "02_Estimators1.html#difference-in-differences-6",
    "href": "02_Estimators1.html#difference-in-differences-6",
    "title": "Panel Data Estimators 1",
    "section": "Difference in Differences",
    "text": "Difference in Differences\n\ndf2$marry_post &lt;- 0\ndf2$marry_post[df2$time &gt;= 4] &lt;- 1\n\ndid1 &lt;- lm(wage ~ marriage_ever*marry_post, data = df2)\nsummary(did1)\n\n\nCall:\nlm(formula = wage ~ marriage_ever * marry_post, data = df2)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n  -550   -500      0    500    550 \n\nCoefficients:\n                          Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept)                 2550.0      224.4  11.366 3.53e-10 ***\nmarriage_ever1              2000.0      317.3   6.304 3.74e-06 ***\nmarry_post                   350.0      317.3   1.103    0.283    \nmarriage_ever1:marry_post    500.0      448.7   1.114    0.278    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 549.5 on 20 degrees of freedom\nMultiple R-squared:  0.8449,    Adjusted R-squared:  0.8217 \nF-statistic: 36.32 on 3 and 20 DF,  p-value: 2.757e-08"
  },
  {
    "objectID": "02_Estimators1.html#difference-in-differences-7",
    "href": "02_Estimators1.html#difference-in-differences-7",
    "title": "Panel Data Estimators 1",
    "section": "Difference in Differences",
    "text": "Difference in Differences\nIn a setting where \\(T=2\\) or in a setting where every observation is treated at the same time, the DD equals the two-ways FE.\nIn general, DD and two-ways DD are often seen as equivalents. However, the situation becomes more complicated when treatment timing varies (Goodman-Bacon 2021).\n\n\n\n\n\n\nTip\n\n\nWhen estimating FE or Diff-in-Diff estimators, “one should restrict the estimation sample to those persons who can potentially experience the treatment during the observation window”. Usually this means that we start with the not-yet-treated and omit the already-treated (Brüderl and Ludwig 2015)."
  },
  {
    "objectID": "02_Estimators1.html#random-effects-estimator",
    "href": "02_Estimators1.html#random-effects-estimator",
    "title": "Panel Data Estimators 1",
    "section": "Random effects estimator",
    "text": "Random effects estimator\nThe RE estimator\n\\[\ny_{it} = \\alpha + \\beta x_{it} + \\alpha_i + \\vartheta_{it}.\n\\]\nInstead of assuming \\(\\alpha_i\\) are fixed effects, we treat them as i.i.d random effects, usually assuming they are normally distributed"
  },
  {
    "objectID": "02_Estimators1.html#random-effects-estimator-1",
    "href": "02_Estimators1.html#random-effects-estimator-1",
    "title": "Panel Data Estimators 1",
    "section": "Random effects estimator",
    "text": "Random effects estimator\nThe RE estimator has two main “advantages” over the FE estimator:\n\nIt is more efficient if \\(\\mathrm{E}(\\alpha_{i} | x_{it}) = 0\\): it has lower standard errors\nIt allows to estimate the effects of time-constant variables"
  },
  {
    "objectID": "02_Estimators1.html#random-effects-estimator-2",
    "href": "02_Estimators1.html#random-effects-estimator-2",
    "title": "Panel Data Estimators 1",
    "section": "Random effects estimator",
    "text": "Random effects estimator\nHowever, it obscures the main advantage of panel data: the relaxation of assumptions for consistency of estimators. The RE estimator needs the same assumptions as POLS for consistency:\n\n\\(\\mathrm{E}(\\alpha_{i} | x_{it}) = 0\\): No time-constant unobserved heterogeneity\n\\(\\mathrm{E}(\\epsilon_{it} | x_{it}) = 0\\): No time-varying unobserved heterogeneity"
  },
  {
    "objectID": "02_Estimators1.html#random-effects-estimator-3",
    "href": "02_Estimators1.html#random-effects-estimator-3",
    "title": "Panel Data Estimators 1",
    "section": "Random effects estimator",
    "text": "Random effects estimator\nWe can also write the RE as a quasi-demeaned estimator:\n\\[\n(y_{it} - \\lambda\\bar{y}_i) = \\beta (x_{it} - \\lambda\\bar{x}_i) + (\\epsilon_{it} - \\lambda\\bar{\\epsilon}_i)  \n\\]\nwhere \\(\\hat{\\lambda} = 1 - \\sqrt{\\frac{\\sigma^2_\\epsilon}{\\sigma^2_\\epsilon + T\\sigma^2_\\alpha}}\\), with \\(\\sigma^2_\\epsilon\\) denoting the residual variance, and \\(\\sigma^2_\\alpha\\) denoting the variance of the individual effects \\(\\alpha_i\\)."
  },
  {
    "objectID": "02_Estimators1.html#random-effects-estimator-4",
    "href": "02_Estimators1.html#random-effects-estimator-4",
    "title": "Panel Data Estimators 1",
    "section": "Random effects estimator",
    "text": "Random effects estimator\nThe RE (as POLS) is thus a weighted average of between and within estimator. The weights are determined by the residual variance in FE as share of total residual variance:\n\\[\n\\begin{split}\n\\beta_{RE} = \\omega_{GLS} \\beta_{FE} + (1-\\omega_{GLS}) \\beta_{BE},\\\\\n\\omega_{GLS} = \\frac{\\sigma^2_{\\tilde{x}}}{\\sigma^2_{\\tilde{x}} + \\phi^2 (\\sigma^2_x-\\sigma^2_{\\tilde{x}})},\\\\\n\\phi = \\sqrt{\\frac{\\hat{\\sigma}^2_{FE}}{\\hat{\\sigma}^2_{BE}}},\n\\end{split}\n\\]"
  },
  {
    "objectID": "02_Estimators1.html#random-effects-estimator-5",
    "href": "02_Estimators1.html#random-effects-estimator-5",
    "title": "Panel Data Estimators 1",
    "section": "Random effects estimator",
    "text": "Random effects estimator\nIt thus follows that:\n\n\\(T\\) large, \\(\\sigma^2_\\alpha\\) large, then RE \\(\\rightarrow\\) FE\n\\(\\sigma^2_\\alpha\\) small, then RE \\(\\rightarrow\\) POLS\n\nThe RE uses all the available information - between and within variance - and weights the two components by its “predictive power”. This makes it the most efficient estimator."
  },
  {
    "objectID": "02_Estimators1.html#re-in-plm",
    "href": "02_Estimators1.html#re-in-plm",
    "title": "Panel Data Estimators 1",
    "section": "RE in plm",
    "text": "RE in plm\nLet’s estimate the RE for the happiness - age example, again using the plm package.\n\n\nCode\nre1 &lt;- plm(happiness ~ age, data = df,\n           index = c(\"id\", \"time\"),\n           effect = \"individual\", model = \"random\")\nsummary(re1)"
  },
  {
    "objectID": "02_Estimators1.html#re-in-plm-1",
    "href": "02_Estimators1.html#re-in-plm-1",
    "title": "Panel Data Estimators 1",
    "section": "RE in plm",
    "text": "RE in plm\nLet’s estimate the RE for the happiness - age example, again using the plm package.\n\n\nCode\nre1 &lt;- plm(happiness ~ age, data = df,\n           index = c(\"id\", \"time\"),\n           effect = \"individual\", model = \"random\")\nsummary(re1)\n\n\nOneway (individual) effect Random Effect Model \n   (Swamy-Arora's transformation)\n\nCall:\nplm(formula = happiness ~ age, data = df, effect = \"individual\", \n    model = \"random\", index = c(\"id\", \"time\"))\n\nBalanced Panel: n = 6, T = 4, N = 24\n\nEffects:\n                  var std.dev share\nidiosyncratic 0.03641 0.19081 0.096\nindividual    0.34396 0.58648 0.904\ntheta: 0.8394\n\nResiduals:\n     Min.   1st Qu.    Median   3rd Qu.      Max. \n-1.054061 -0.353296  0.013426  0.316500  0.898703 \n\nCoefficients:\n             Estimate Std. Error z-value  Pr(&gt;|z|)    \n(Intercept)  6.933947   1.534054  4.5200 6.183e-06 ***\nage         -0.015621   0.031277 -0.4994    0.6175    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nTotal Sum of Squares:    5.1257\nResidual Sum of Squares: 5.0683\nR-Squared:      0.011211\nAdj. R-Squared: -0.033734\nChisq: 0.249442 on 1 DF, p-value: 0.61747"
  },
  {
    "objectID": "02_Estimators1.html#equal-weights-of-within-and-between",
    "href": "02_Estimators1.html#equal-weights-of-within-and-between",
    "title": "Panel Data Estimators 1",
    "section": "Equal weights of within and between",
    "text": "Equal weights of within and between\n\n\nCode\nN &lt;- 6\nT &lt;- 4\n### Models\n# Total line for plot\nlm1 &lt;- lm(happiness ~ age, data = df)\nlm2 &lt;- lm(happiness ~ age + cohort, data = df)\nlm3 &lt;- lm(happiness ~ age + idname, data = df)\nlm4 &lt;- lm(m_happiness ~ m_age, data = df)\nre &lt;- plm(happiness ~ age, df, model = \"random\", effect = \"individual\")\n\n### Compare POLS, BE, FE, and RE\nestimates &lt;- data.frame(matrix(NA, ncol = 3, nrow = 4))\nnames(estimates) &lt;- c(\"Model\", \"Intercept\", \"slope\")\nestimates[1,] &lt;- c(\"POLS\",\n                   lm1$coefficients[1],\n                   lm1$coefficients[2])\nestimates[2,] &lt;- c(\"BE\",\n                   lm4$coefficients[1], \n                   lm4$coefficients[2])\nestimates[3,] &lt;- c(\"FE\",\n                   lm3$coefficients[1] + 1/N * lm3$coefficients[3]  + 1/N * lm3$coefficients[4] \n                   + 1/N * lm3$coefficients[5]  + 1/N * lm3$coefficients[6]  + 1/N * lm3$coefficients[7], \n                   lm3$coefficients[2])\nestimates[4,] &lt;- c(\"RE\",\n                   re$coefficients[1], \n                   re$coefficients[2])\nestimates[, -1] &lt;- apply(estimates[, -1], 2, FUN = function(x) as.numeric(x))\n\nnewdf &lt;- data.frame(matrix(NA, ncol = 2, nrow = 2))\nnames(newdf) &lt;- c(\"x\", \"y\")\nnewdf$x &lt;- c(min(df$age), max(df$age))\nfor(i in 1:nrow(estimates)){\n  newdf$y &lt;- estimates[i, \"Intercept\"] + estimates[i, \"slope\"]*newdf$x\n  newdf$Model &lt;- estimates[i, \"Model\"]\n  if(i == 1){\n    pred &lt;- newdf\n  }else{pred &lt;- rbind(pred, newdf)}\n}\n\nestimates$Model &lt;- factor(estimates$Model, levels = c(\"POLS\", \"BE\", \"FE\", \"RE\"))\n\ngg_color_hue &lt;- function(n) {\n  hues = seq(15, 375, length = n + 1)\n  hcl(h = hues, l = 65, c = 100)[1:n]\n}\n\nzp6 &lt;- ggplot(df, aes(age, happiness)) +\n  geom_point(aes(x = age, y = happiness, shape = idname),\n             colour = rep(gg_color_hue(6), each = T),\n              size = 2, stroke = 1, show.legend = FALSE) +\n  geom_smooth(method = 'lm', formula = y ~ x, se = FALSE, show.legend = FALSE,\n              linetype = \"dashed\", aes(group = idname), colour = alpha(\"gray\", 1)) +\n  geom_point(data = unique(df[, c(\"m_age\", \"m_happiness\", \"idname\")]),\n             aes(x = m_age, y = m_happiness, shape = idname),\n             colour = gg_color_hue(6), alpha = 0.5,\n              size = 3, stroke = 2, show.legend = FALSE) +\n  scale_fill_manual(values = cbp2[-c(1, 2)]) +\n  scale_colour_manual(values = cbp2[-c(1, 2)]) + \n  scale_shape_manual(values = c(15:18, 25, 20)) +\n  geom_abline(data = estimates, lwd = 1.2,\n              mapping = aes(intercept = Intercept, slope = slope, \n                            colour = Model, linetype = Model)) +\n  scale_linetype_manual(values = c(\"solid\", \"twodash\", \"longdash\", \"dotdash\")) +\n  scale_color_viridis(discrete = TRUE, option = \"D\")+\n  ylim(3.3, 9.2) + expand_limits(y = c(0, 0)) + \n  theme_classic() +\n  theme(legend.key = element_blank(), legend.title = element_blank(),\n        legend.position = c(0.95,0.05), legend.justification = c(\"right\", \"bottom\"),\n        legend.background = element_blank(),\n        legend.box.background = element_rect(colour = \"black\"),\n        plot.title = element_text(hjust = 0.5))\nzp6"
  },
  {
    "objectID": "02_Estimators1.html#increasing-t",
    "href": "02_Estimators1.html#increasing-t",
    "title": "Panel Data Estimators 1",
    "section": "Increasing T",
    "text": "Increasing T\n\n\nCode\nN &lt;- 6\nT &lt;- 8\n\nset.seed(123)\ndf &lt;- simdata(N = N, T = T, uw_sd = 0, age_range = c(20:60))\n\n### Models\n# Total line for plot\nlm1 &lt;- lm(happiness ~ age, data = df)\nlm2 &lt;- lm(happiness ~ age + cohort, data = df)\nlm3 &lt;- lm(happiness ~ age + idname, data = df)\nlm4 &lt;- lm(m_happiness ~ m_age, data = df)\nre &lt;- plm(happiness ~ age, df, model = \"random\", effect = \"individual\")\n\n### Compare POLS, BE, FE, and RE\nestimates &lt;- data.frame(matrix(NA, ncol = 3, nrow = 4))\nnames(estimates) &lt;- c(\"Model\", \"Intercept\", \"slope\")\nestimates[1,] &lt;- c(\"POLS\",\n                   lm1$coefficients[1],\n                   lm1$coefficients[2])\nestimates[2,] &lt;- c(\"BE\",\n                   lm4$coefficients[1], \n                   lm4$coefficients[2])\nestimates[3,] &lt;- c(\"FE\",\n                   lm3$coefficients[1] + 1/N * lm3$coefficients[3]  + 1/N * lm3$coefficients[4] \n                   + 1/N * lm3$coefficients[5]  + 1/N * lm3$coefficients[6]  + 1/N * lm3$coefficients[7], \n                   lm3$coefficients[2])\nestimates[4,] &lt;- c(\"RE\",\n                   re$coefficients[1], \n                   re$coefficients[2])\nestimates[, -1] &lt;- apply(estimates[, -1], 2, FUN = function(x) as.numeric(x))\n\nnewdf &lt;- data.frame(matrix(NA, ncol = 2, nrow = 2))\nnames(newdf) &lt;- c(\"x\", \"y\")\nnewdf$x &lt;- c(min(df$age), max(df$age))\nfor(i in 1:nrow(estimates)){\n  newdf$y &lt;- estimates[i, \"Intercept\"] + estimates[i, \"slope\"]*newdf$x\n  newdf$Model &lt;- estimates[i, \"Model\"]\n  if(i == 1){\n    pred &lt;- newdf\n  }else{pred &lt;- rbind(pred, newdf)}\n}\n\nestimates$Model &lt;- factor(estimates$Model, levels = c(\"POLS\", \"BE\", \"FE\", \"RE\"))\n\ngg_color_hue &lt;- function(n) {\n  hues = seq(15, 375, length = n + 1)\n  hcl(h = hues, l = 65, c = 100)[1:n]\n}\n\nzp7 &lt;- ggplot(df, aes(age, happiness)) +\n  geom_point(aes(x = age, y = happiness, shape = idname),\n             colour = rep(gg_color_hue(6), each = T),\n              size = 2, stroke = 1, show.legend = FALSE) +\n  geom_smooth(method = 'lm', formula = y ~ x, se = FALSE, show.legend = FALSE,\n              linetype = \"dashed\", aes(group = idname), colour = alpha(\"gray\", 1)) +\n  geom_point(data = unique(df[, c(\"m_age\", \"m_happiness\", \"idname\")]),\n             aes(x = m_age, y = m_happiness, shape = idname),\n             colour = gg_color_hue(6), alpha = 0.5,\n              size = 3, stroke = 2, show.legend = FALSE) +\n  scale_fill_manual(values = cbp2[-c(1, 2)]) +\n  scale_colour_manual(values = cbp2[-c(1, 2)]) + \n  scale_shape_manual(values = c(15:18, 25, 20)) +\n  geom_abline(data = estimates, lwd = 1.2,\n              mapping = aes(intercept = Intercept, slope = slope, \n                            colour = Model, linetype = Model)) +\n  scale_linetype_manual(values = c(\"solid\", \"twodash\", \"longdash\", \"dotdash\")) +\n  scale_color_viridis(discrete = TRUE, option = \"D\")+\n  scale_linetype_manual(values = c(\"solid\", \"twodash\", \"longdash\", \"dotdash\")) +\n  ylim(3.3, 9.2) + expand_limits(y = c(0, 0)) + \n  theme_classic() +\n  theme(legend.key = element_blank(), legend.title = element_blank(),\n        legend.position = c(0.95,0.05), legend.justification = c(\"right\", \"bottom\"),\n        legend.background = element_blank(),\n        legend.box.background = element_rect(colour = \"black\"),\n        plot.title = element_text(hjust = 0.5))\nzp7"
  },
  {
    "objectID": "02_Estimators1.html#increasing-the-within-unit-noise",
    "href": "02_Estimators1.html#increasing-the-within-unit-noise",
    "title": "Panel Data Estimators 1",
    "section": "Increasing the within-unit noise",
    "text": "Increasing the within-unit noise\n\n\nCode\nN &lt;- 6\nT &lt;- 8\n\nset.seed(123)\ndf &lt;- simdata(N = N, T = T, uw_sd = 0.5, age_range = c(20:60))\n\n### Models\n# Total line for plot\nlm1 &lt;- lm(happiness ~ age, data = df)\nlm2 &lt;- lm(happiness ~ age + cohort, data = df)\nlm3 &lt;- lm(happiness ~ age + idname, data = df)\nlm4 &lt;- lm(m_happiness ~ m_age, data = df)\nre &lt;- plm(happiness ~ age, df, model = \"random\", effect = \"individual\")\n\n### Compare POLS, BE, FE, and RE\nestimates &lt;- data.frame(matrix(NA, ncol = 3, nrow = 4))\nnames(estimates) &lt;- c(\"Model\", \"Intercept\", \"slope\")\nestimates[1,] &lt;- c(\"POLS\",\n                   lm1$coefficients[1],\n                   lm1$coefficients[2])\nestimates[2,] &lt;- c(\"BE\",\n                   lm4$coefficients[1], \n                   lm4$coefficients[2])\nestimates[3,] &lt;- c(\"FE\",\n                   lm3$coefficients[1] + 1/N * lm3$coefficients[3]  + 1/N * lm3$coefficients[4] \n                   + 1/N * lm3$coefficients[5]  + 1/N * lm3$coefficients[6]  + 1/N * lm3$coefficients[7], \n                   lm3$coefficients[2])\nestimates[4,] &lt;- c(\"RE\",\n                   re$coefficients[1], \n                   re$coefficients[2])\nestimates[, -1] &lt;- apply(estimates[, -1], 2, FUN = function(x) as.numeric(x))\n\nnewdf &lt;- data.frame(matrix(NA, ncol = 2, nrow = 2))\nnames(newdf) &lt;- c(\"x\", \"y\")\nnewdf$x &lt;- c(min(df$age), max(df$age))\nfor(i in 1:nrow(estimates)){\n  newdf$y &lt;- estimates[i, \"Intercept\"] + estimates[i, \"slope\"]*newdf$x\n  newdf$Model &lt;- estimates[i, \"Model\"]\n  if(i == 1){\n    pred &lt;- newdf\n  }else{pred &lt;- rbind(pred, newdf)}\n}\n\nestimates$Model &lt;- factor(estimates$Model, levels = c(\"POLS\", \"BE\", \"FE\", \"RE\"))\n\ngg_color_hue &lt;- function(n) {\n  hues = seq(15, 375, length = n + 1)\n  hcl(h = hues, l = 65, c = 100)[1:n]\n}\n\nzp7 &lt;- ggplot(df, aes(age, happiness)) +\n  geom_point(aes(x = age, y = happiness, shape = idname),\n             colour = rep(gg_color_hue(6), each = T),\n              size = 2, stroke = 1, show.legend = FALSE) +\n  geom_smooth(method = 'lm', formula = y ~ x, se = FALSE, show.legend = FALSE,\n              linetype = \"dashed\", aes(group = idname), colour = alpha(\"gray\", 1)) +\n  geom_point(data = unique(df[, c(\"m_age\", \"m_happiness\", \"idname\")]),\n             aes(x = m_age, y = m_happiness, shape = idname),\n             colour = gg_color_hue(6), alpha = 0.5,\n              size = 3, stroke = 2, show.legend = FALSE) +\n  scale_fill_manual(values = cbp2[-c(1, 2)]) +\n  scale_colour_manual(values = cbp2[-c(1, 2)]) + \n  scale_shape_manual(values = c(15:18, 25, 20)) +\n  geom_abline(data = estimates, lwd = 1.2,\n              mapping = aes(intercept = Intercept, slope = slope, \n                            colour = Model, linetype = Model)) +\n  scale_linetype_manual(values = c(\"solid\", \"twodash\", \"longdash\", \"dotdash\")) +\n  scale_color_viridis(discrete = TRUE, option = \"D\")+\n  ylim(3.3, 9.2) + expand_limits(y = c(0, 0)) + \n  theme_classic() +\n  theme(legend.key = element_blank(), legend.title = element_blank(),\n        legend.position = c(0.95,0.05), legend.justification = c(\"right\", \"bottom\"),\n        legend.background = element_blank(),\n        legend.box.background = element_rect(colour = \"black\"),\n        plot.title = element_text(hjust = 0.5))\nzp7"
  },
  {
    "objectID": "02_Estimators1.html#references",
    "href": "02_Estimators1.html#references",
    "title": "Panel Data Estimators 1",
    "section": "References",
    "text": "References\n\n\n&lt;Home&gt;\n\n\n\nBrüderl, Josef, and Volker Ludwig. 2015. “Fixed-Effects Panel Regression.” In The Sage Handbook of Regression Analysis and Causal Inference, edited by Henning Best and Christof Wolf, 327–57. Los Angeles: Sage.\n\n\nCunningham, Scott. 2021. Causal Inference: The Mixtape. New Haven and London: Yale University Press.\n\n\nGoodman-Bacon, Andrew. 2021. “Difference-in-Differences with Variation in Treatment Timing.” Journal of Econometrics 225 (2): 254–77. https://doi.org/10.1016/j.jeconom.2021.03.014.\n\n\nHuntington-Klein, Nick. 2021. The Effect: An Introduction to Research Design and Causality. Boca Raton: Chapman & Hall/CRC.\n\n\nWooldridge, Jeffrey M. 2010. Econometric Analysis of Cross Section and Panel Data. Cambridge, Mass.: MIT Press."
  },
  {
    "objectID": "01_Intro.html#this-course",
    "href": "01_Intro.html#this-course",
    "title": "Panel Data Introduction",
    "section": "This course",
    "text": "This course\n\n\nOutline\n\nIntroduction Panel Data\nVariance Components\nEstimators: FE & RE & Diff-in-Diff\nDynamic Diff-in-Diff\nFixed Effects Individual Slopes\n\n\nMe\n Tobias Rüttenauer\n t.ruttenauer@ucl.ac.uk\n Lecturer in Quantitative Social Science at UCL\n Environmental Sociology"
  },
  {
    "objectID": "01_Intro.html#further-materials",
    "href": "01_Intro.html#further-materials",
    "title": "Panel Data Introduction",
    "section": "Further Materials",
    "text": "Further Materials\nThis material in Handbook format: Rüttenauer and Kapelle (2024)\nSlides by Josef Brüderl and Volker Ludwig. See also Brüderl and Ludwig (2015).\nBooks:\n\nIntuitive: Allison (2009)\nComprehensive and formal: Wooldridge (2010)\nFor R experts: Croissant and Millo (2019)\nGeneral introductions to causal estimation techniques: Angrist and Pischke (2015), Cunningham (2021), Firebaugh (2008), Huntington-Klein (2021)\n\nThe books by Cunningham (2021) (Link) and Huntington-Klein (2021) (Link) are freely available online!"
  },
  {
    "objectID": "01_Intro.html#why-panel-data-analysis",
    "href": "01_Intro.html#why-panel-data-analysis",
    "title": "Panel Data Introduction",
    "section": "Why panel data analysis?",
    "text": "Why panel data analysis?\n\nIn empirical social sciences, we are often interested in the causal research questions: we want to investigate questions of cause and effect.\nHowever, randomized controlled trials (RCT) are often infeasible (e.g. effects of education, marriage, pregnancy).\n\n\nA potential middle ground between those two approaches: “compare alike with alike”.\nWith panel data, we observe the same unit (person, region, or country) repeatedly over time. We can then not only compare two different units to each other. We can also compare a unit in an earlier stage to the same unit in a later stage."
  },
  {
    "objectID": "01_Intro.html#panel-data-structure",
    "href": "01_Intro.html#panel-data-structure",
    "title": "Panel Data Introduction",
    "section": "Panel Data Structure",
    "text": "Panel Data Structure\nUsually cross-sectional data is organized as a matrix, where rows represent the observation / individual and the columns hold the variables. In panel data settings, we need to add the dimension of time. There are two ways to do so:\n\nLong format: \\(N \\times T\\) observations (rows), with variables “id” and “time”.\nWide format: \\(N\\) observations, and \\(T \\times K\\) variables, which one variable for each time-period."
  },
  {
    "objectID": "01_Intro.html#panel-data-structure-1",
    "href": "01_Intro.html#panel-data-structure-1",
    "title": "Panel Data Introduction",
    "section": "Panel Data Structure",
    "text": "Panel Data Structure\nLet’s have a look at the “Males” data of the plm package.\n\nlibrary(\"plm\")\ndata(\"Males\")\nhead(Males[,1:5], n = 16)\n\n   nr year school exper union\n1  13 1980     14     1    no\n2  13 1981     14     2   yes\n3  13 1982     14     3    no\n4  13 1983     14     4    no\n5  13 1984     14     5    no\n6  13 1985     14     6    no\n7  13 1986     14     7    no\n8  13 1987     14     8    no\n9  17 1980     13     4    no\n10 17 1981     13     5    no\n11 17 1982     13     6    no\n12 17 1983     13     7    no\n13 17 1984     13     8    no\n14 17 1985     13     9    no\n15 17 1986     13    10    no\n16 17 1987     13    11    no"
  },
  {
    "objectID": "01_Intro.html#panel-data-structure-2",
    "href": "01_Intro.html#panel-data-structure-2",
    "title": "Panel Data Introduction",
    "section": "Panel Data Structure",
    "text": "Panel Data Structure\nMoreover, there two types of panel data:\n\nBalanced: Contains information for each unit at each time period\nUnbalanced: Some units have missing information at some time periods\n\n\nis.pbalanced(Males, index = c(\"nr\", \"year\"))\n\n[1] TRUE"
  },
  {
    "objectID": "01_Intro.html#panel-attrition",
    "href": "01_Intro.html#panel-attrition",
    "title": "Panel Data Introduction",
    "section": "Panel Attrition",
    "text": "Panel Attrition\n\nSOEP Documentation"
  },
  {
    "objectID": "01_Intro.html#panel-surveys",
    "href": "01_Intro.html#panel-surveys",
    "title": "Panel Data Introduction",
    "section": "Panel surveys",
    "text": "Panel surveys\nSome examples\n\n\n\nPSID\nNational Longitudinal Survey of Youth\nUnderstanding Society\nMillennium Cohort Study\n\n\n\nSOEP\nPairfam\nSHARE\nLISS\n\n\n\nThe Comparative Panel File provides an infrastructure of data harmonisation across various panels. See Turek, Kalmijn, and Leopold (2021)."
  },
  {
    "objectID": "01_Intro.html#panel-transformation",
    "href": "01_Intro.html#panel-transformation",
    "title": "Panel Data Introduction",
    "section": "Panel transformation",
    "text": "Panel transformation\nA nice feature of panel data is that we can do some within-person transformation. For instance we can calculate the lags and leads, or the first differences of data.\n\n\n\n\n\n\nNote\n\n\nalways make sure the data is sorted properly before you do!"
  },
  {
    "objectID": "01_Intro.html#panel-transformation-1",
    "href": "01_Intro.html#panel-transformation-1",
    "title": "Panel Data Introduction",
    "section": "Panel transformation",
    "text": "Panel transformation\nPerson-specific summary values\n\n# Order data\nMales &lt;- Males[order(Males$nr, Males$year),]\n\n# Person specific means\nMales$m_wage &lt;- ave(Males$wage,\n                    Males$nr,\n                    FUN = function(x) mean(x, na.rm = TRUE))"
  },
  {
    "objectID": "01_Intro.html#panel-transformation-2",
    "href": "01_Intro.html#panel-transformation-2",
    "title": "Panel Data Introduction",
    "section": "Panel transformation",
    "text": "Panel transformation\nLag and first difference\n\n# Order data\nMales &lt;- Males[order(Males$nr, Males$year),]\n\n# Lag (last years value)\nMales$lag_wage &lt;- ave(Males$wage,\n                      Males$nr,\n                      FUN = function(x) dplyr::lag(x, n = 1))\n\n# First difference (this years value minus last years value)\nMales$fd_wage &lt;- ave(Males$wage,\n                      Males$nr,\n                      FUN = function(x) x - dplyr::lag(x, n = 1))"
  },
  {
    "objectID": "01_Intro.html#panel-transformation-3",
    "href": "01_Intro.html#panel-transformation-3",
    "title": "Panel Data Introduction",
    "section": "Panel transformation",
    "text": "Panel transformation\n\nhead(Males[, c(\"nr\", \"year\", \"wage\", \"m_wage\", \"lag_wage\", \"fd_wage\")], n = 16)\n\n   nr year       wage   m_wage   lag_wage     fd_wage\n1  13 1980  1.1975402 1.255652         NA          NA\n2  13 1981  1.8530600 1.255652  1.1975402  0.65551979\n3  13 1982  1.3444617 1.255652  1.8530600 -0.50859832\n4  13 1983  1.4332133 1.255652  1.3444617  0.08875166\n5  13 1984  1.5681251 1.255652  1.4332133  0.13491174\n6  13 1985  1.6998909 1.255652  1.5681251  0.13176586\n7  13 1986 -0.7202626 1.255652  1.6998909 -2.42015352\n8  13 1987  1.6691879 1.255652 -0.7202626  2.38945049\n9  17 1980  1.6759624 1.637786         NA          NA\n10 17 1981  1.5183982 1.637786  1.6759624 -0.15756420\n11 17 1982  1.5591905 1.637786  1.5183982  0.04079228\n12 17 1983  1.7254101 1.637786  1.5591905  0.16621961\n13 17 1984  1.6220223 1.637786  1.7254101 -0.10338777\n14 17 1985  1.6085883 1.637786  1.6220223 -0.01343405\n15 17 1986  1.5723854 1.637786  1.6085883 -0.03620286\n16 17 1987  1.8203339 1.637786  1.5723854  0.24794844"
  },
  {
    "objectID": "01_Intro.html#references",
    "href": "01_Intro.html#references",
    "title": "Panel Data Introduction",
    "section": "References",
    "text": "References\n\n\n&lt;Home&gt;\n\n\n\nAllison, Paul David. 2009. Fixed Effects Regression Models. Vol. 160. Quantitative Applications in the Social Sciences. Los Angeles: Sage.\n\n\nAngrist, Joshua David, and Jörn-Steffen Pischke. 2015. Mastering ’Metrics: The Path from Cause to Effect. Princeton: Princeton Univ. Press.\n\n\nBrüderl, Josef, and Volker Ludwig. 2015. “Fixed-Effects Panel Regression.” In The Sage Handbook of Regression Analysis and Causal Inference, edited by Henning Best and Christof Wolf, 327–57. Los Angeles: Sage.\n\n\nCroissant, Yves, and Giovanni Millo. 2019. Panel Data Econometrics with R. Hoboken, NJ: John Wiley and Sons.\n\n\nCunningham, Scott. 2021. Causal Inference: The Mixtape. New Haven and London: Yale University Press.\n\n\nFirebaugh, Glenn. 2008. Seven Rules for Social Research. Princeton, N.J. and Woodstock: Princeton University Press.\n\n\nHuntington-Klein, Nick. 2021. The Effect: An Introduction to Research Design and Causality. Boca Raton: Chapman & Hall/CRC.\n\n\nRüttenauer, Tobias, and Nicole Kapelle. 2024. “Panel Data Analysis.” https://doi.org/10.31235/osf.io/3mfzq.\n\n\nTurek, Konrad, Matthijs Kalmijn, and Thomas Leopold. 2021. “The Comparative Panel File: Harmonized Household Panel Surveys from Seven Countries.” European Sociological Review 37 (3): 505–23. https://doi.org/10.1093/esr/jcab006.\n\n\nWooldridge, Jeffrey M. 2010. Econometric Analysis of Cross Section and Panel Data. Cambridge, Mass.: MIT Press."
  },
  {
    "objectID": "03_Estimators2.html#the-shape-of-treatment-effects",
    "href": "03_Estimators2.html#the-shape-of-treatment-effects",
    "title": "Panel Data Estimators 2",
    "section": "The shape of treatment effects",
    "text": "The shape of treatment effects\n\nRüttenauer and Best (2021)"
  },
  {
    "objectID": "03_Estimators2.html#the-shape-of-treatment-effects-1",
    "href": "03_Estimators2.html#the-shape-of-treatment-effects-1",
    "title": "Panel Data Estimators 2",
    "section": "The shape of treatment effects",
    "text": "The shape of treatment effects\n\nZoch and Heyne (2023)"
  },
  {
    "objectID": "03_Estimators2.html#the-shape-of-treatment-effects-2",
    "href": "03_Estimators2.html#the-shape-of-treatment-effects-2",
    "title": "Panel Data Estimators 2",
    "section": "The shape of treatment effects",
    "text": "The shape of treatment effects\n\nClark and Georgellis (2013)"
  },
  {
    "objectID": "03_Estimators2.html#event-study-design",
    "href": "03_Estimators2.html#event-study-design",
    "title": "Panel Data Estimators 2",
    "section": "Event study design",
    "text": "Event study design\n\nVarious impact functions for event study designs from Brüderl/Ludwig 2019 teaching materials. See also Ludwig and Brüderl (2021)"
  },
  {
    "objectID": "03_Estimators2.html#event-study-design-1",
    "href": "03_Estimators2.html#event-study-design-1",
    "title": "Panel Data Estimators 2",
    "section": "Event study design",
    "text": "Event study design\nFor many research questions, treatment effects are likely to follow a temporal pattern rather than being uniform.\nIf there is a binary treatment indicator (e.g. marriage, childbirth), we can use impact functions (or count functions) around the onset of the treatment in twoway FE to investigate its temporal patterns (Ludwig and Brüderl 2021)."
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage",
    "href": "03_Estimators2.html#example---marriage-and-wage",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage\n\nlibrary(feisr)\ndata(\"mwp\", package = \"feisr\")\nhead(mwp)\n\n  id year      lnw      exp      expq marry evermarry enrol yeduc age cohort\n1  1 1981 1.934358 1.076923  1.159763     0         1     1    11  18   1963\n2  1 1983 2.468140 3.019231  9.115755     0         1     1    12  20   1963\n3  1 1984 2.162480 4.038462 16.309174     0         1     1    12  21   1963\n4  1 1985 1.746280 5.076923 25.775146     0         1     0    12  22   1963\n5  1 1986 2.527840 6.096154 37.163090     0         1     1    13  23   1963\n6  1 1987 2.365361 7.500000 56.250000     0         1     1    13  24   1963\n  yeargr yeargr1 yeargr2 yeargr3 yeargr4 yeargr5\n1      2       0       1       0       0       0\n2      2       0       1       0       0       0\n3      2       0       1       0       0       0\n4      2       0       1       0       0       0\n5      3       0       0       1       0       0\n6      3       0       0       1       0       0"
  },
  {
    "objectID": "03_Estimators2.html#dummy-impact-function",
    "href": "03_Estimators2.html#dummy-impact-function",
    "title": "Panel Data Estimators 2",
    "section": "Dummy impact function",
    "text": "Dummy impact function\n\n# Order\nmwp &lt;- mwp[order(mwp$id, mwp$year),]\n\n# Count since treatment by id\nmwp$Treat_count &lt;- ave(\n  mwp$marry,\n  mwp$id,\n  FUN = function(x)\n    cumsum(x)\n)\n\n# First treatment instance & distribute\nmwp$Treat_first &lt;- ifelse(mwp$Treat_count == 1, \n                          mwp$year, \n                          0)\nmwp$Treat_first &lt;- ave(mwp$Treat_first,\n                       mwp$id,\n                       FUN = max)"
  },
  {
    "objectID": "03_Estimators2.html#dummy-impact-function-1",
    "href": "03_Estimators2.html#dummy-impact-function-1",
    "title": "Panel Data Estimators 2",
    "section": "Dummy impact function",
    "text": "Dummy impact function\n\n# Order\nmwp &lt;- mwp[order(mwp$id, mwp$year),]\n\n# Count since treatment by id\nmwp$Treat_count &lt;- ave(\n  mwp$marry,\n  mwp$id,\n  FUN = function(x)\n    cumsum(x)\n)\n\n# First treatment instance & distribute\nmwp$Treat_first &lt;- ifelse(mwp$Treat_count == 1, \n                          mwp$year, \n                          0)\nmwp$Treat_first &lt;- ave(mwp$Treat_first,\n                       mwp$id,\n                       FUN = max)"
  },
  {
    "objectID": "03_Estimators2.html#dummy-impact-function-2",
    "href": "03_Estimators2.html#dummy-impact-function-2",
    "title": "Panel Data Estimators 2",
    "section": "Dummy impact function",
    "text": "Dummy impact function\n\n# Create event time indicator\nmwp$time_to_treatment &lt;- mwp$year - mwp$Treat_first\n\n# Define reference periods (use minus 2 to allow for anticipation in -1)\ncontrol &lt;- c(-2, min(mwp$time_to_treatment)) \n\nmwp$time_to_treatment &lt;-\n  ifelse(\n    mwp$time_to_treatment %in% control | mwp$Treat_first == 0,\n    -9999,\n    mwp$time_to_treatment\n  )\nmwp$time_to_treatment &lt;-\n  relevel(as.factor(mwp$time_to_treatment), \"-9999\")"
  },
  {
    "objectID": "03_Estimators2.html#dummy-impact-function-3",
    "href": "03_Estimators2.html#dummy-impact-function-3",
    "title": "Panel Data Estimators 2",
    "section": "Dummy impact function",
    "text": "Dummy impact function\n\n# Create event time indicator\nmwp$time_to_treatment &lt;- mwp$year - mwp$Treat_first\n\n# Define reference periods (use minus 2 to allow for anticipation in -1)\ncontrol &lt;- c(-2, min(mwp$time_to_treatment)) \n\nmwp$time_to_treatment &lt;-\n  ifelse(\n    mwp$time_to_treatment %in% control | mwp$Treat_first == 0,\n    -9999,\n    mwp$time_to_treatment\n  )\nmwp$time_to_treatment &lt;-\n  relevel(as.factor(mwp$time_to_treatment), \"-9999\")"
  },
  {
    "objectID": "03_Estimators2.html#dummy-impact-function-4",
    "href": "03_Estimators2.html#dummy-impact-function-4",
    "title": "Panel Data Estimators 2",
    "section": "Dummy impact function",
    "text": "Dummy impact function\n\n# Create event time indicator\nmwp$time_to_treatment &lt;- mwp$year - mwp$Treat_first\n\n# Define reference periods (use minus 2 to allow for anticipation in -1)\ncontrol &lt;- c(-2, min(mwp$time_to_treatment)) \n\nmwp$time_to_treatment &lt;-\n  ifelse(\n    mwp$time_to_treatment %in% control | mwp$Treat_first == 0,\n    -9999,\n    mwp$time_to_treatment\n  )\nmwp$time_to_treatment &lt;-\n  relevel(as.factor(mwp$time_to_treatment), \"-9999\")"
  },
  {
    "objectID": "03_Estimators2.html#dummy-impact-function-5",
    "href": "03_Estimators2.html#dummy-impact-function-5",
    "title": "Panel Data Estimators 2",
    "section": "Dummy impact function",
    "text": "Dummy impact function\n\ntable(mwp$time_to_treatment)\n\n\n-9999   -19   -18   -17   -16   -15   -14   -13   -12   -11   -10    -9    -8 \n  787     3     4     9     8    12    17    21    27    33    39    56    71 \n   -7    -6    -5    -4    -3    -1     0     1     2     3     4     5     6 \n   84   103   109   123   130   148   204   152   149   123   111   104    89 \n    7     8     9    10    11    12    13    14 \n   77    70    63    52    45    34    36     7"
  },
  {
    "objectID": "03_Estimators2.html#fe-with-dummy-impact-function",
    "href": "03_Estimators2.html#fe-with-dummy-impact-function",
    "title": "Panel Data Estimators 2",
    "section": "FE with Dummy impact function",
    "text": "FE with Dummy impact function\n\n### FE with dummy impact function\nfe_dummy &lt;-\n  plm(lnw ~ time_to_treatment + enrol + yeduc + exp + I(exp^2),\n      data = mwp,\n      model = \"within\",\n      effect = \"twoways\")\n\n# add cluster robust SEs\nvcovx_fe_dummy &lt;-\n  vcovHC(fe_dummy,\n         cluster = \"group\",\n         method = \"arellano\",\n         type = \"HC3\")\nfe_dummy$vcov &lt;- vcovx_fe_dummy"
  },
  {
    "objectID": "03_Estimators2.html#fe-with-dummy-impact-function-1",
    "href": "03_Estimators2.html#fe-with-dummy-impact-function-1",
    "title": "Panel Data Estimators 2",
    "section": "FE with Dummy impact function",
    "text": "FE with Dummy impact function\n\n### FE with dummy impact function\nfe_dummy &lt;-\n  plm(lnw ~ time_to_treatment + enrol + yeduc + exp + I(exp^2),\n      data = mwp,\n      model = \"within\",\n      effect = \"twoways\")\n\n# add cluster robust SEs\nvcovx_fe_dummy &lt;-\n  vcovHC(fe_dummy,\n         cluster = \"group\",\n         method = \"arellano\",\n         type = \"HC3\")\nfe_dummy$vcov &lt;- vcovx_fe_dummy"
  },
  {
    "objectID": "03_Estimators2.html#fe-with-dummy-impact-function-2",
    "href": "03_Estimators2.html#fe-with-dummy-impact-function-2",
    "title": "Panel Data Estimators 2",
    "section": "FE with Dummy impact function",
    "text": "FE with Dummy impact function\n\nsummary(fe_dummy)\n\nTwoways effects Within Model\n\nCall:\nplm(formula = lnw ~ time_to_treatment + enrol + yeduc + exp + \n    I(exp^2), data = mwp, effect = \"twoways\", model = \"within\")\n\nUnbalanced Panel: n = 268, T = 4-19, N = 3100\n\nResiduals:\n      Min.    1st Qu.     Median    3rd Qu.       Max. \n-2.5026439 -0.1550302  0.0078324  0.1732288  2.0689119 \n\nCoefficients:\n                       Estimate Std. Error t-value  Pr(&gt;|t|)    \ntime_to_treatment-19 -0.2545119  0.3197734 -0.7959 0.4261505    \ntime_to_treatment-18 -0.7290596  0.2102088 -3.4683 0.0005318 ***\ntime_to_treatment-17 -0.0670156  0.1573872 -0.4258 0.6702857    \ntime_to_treatment-16 -0.1049867  0.2313300 -0.4538 0.6499799    \ntime_to_treatment-15 -0.1207496  0.1447592 -0.8341 0.4042730    \ntime_to_treatment-14 -0.1645816  0.1450179 -1.1349 0.2565126    \ntime_to_treatment-13 -0.2353898  0.0931669 -2.5265 0.0115744 *  \ntime_to_treatment-12 -0.1645905  0.0940469 -1.7501 0.0802134 .  \ntime_to_treatment-11 -0.1936489  0.0895855 -2.1616 0.0307334 *  \ntime_to_treatment-10 -0.0798882  0.0834633 -0.9572 0.3385667    \ntime_to_treatment-9  -0.2146613  0.0773115 -2.7766 0.0055303 ** \ntime_to_treatment-8  -0.1260775  0.0651812 -1.9343 0.0531827 .  \ntime_to_treatment-7  -0.0652457  0.0610401 -1.0689 0.2852082    \ntime_to_treatment-6  -0.0240969  0.0516770 -0.4663 0.6410388    \ntime_to_treatment-5  -0.0405286  0.0444550 -0.9117 0.3620179    \ntime_to_treatment-4  -0.0495005  0.0406408 -1.2180 0.2233267    \ntime_to_treatment-3  -0.0449544  0.0383303 -1.1728 0.2409696    \ntime_to_treatment-1   0.0341265  0.0263220  1.2965 0.1949103    \ntime_to_treatment0    0.0238765  0.0312467  0.7641 0.4448562    \ntime_to_treatment1    0.0979309  0.0387631  2.5264 0.0115790 *  \ntime_to_treatment2    0.1110830  0.0412254  2.6945 0.0070913 ** \ntime_to_treatment3    0.1193417  0.0495054  2.4107 0.0159874 *  \ntime_to_treatment4    0.0921361  0.0520111  1.7715 0.0765922 .  \ntime_to_treatment5    0.0658393  0.0580900  1.1334 0.2571438    \ntime_to_treatment6    0.0988637  0.0623235  1.5863 0.1127855    \ntime_to_treatment7    0.0739871  0.0692210  1.0689 0.2852286    \ntime_to_treatment8    0.1359779  0.0760370  1.7883 0.0738348 .  \ntime_to_treatment9    0.0831122  0.0802180  1.0361 0.3002557    \ntime_to_treatment10   0.0530242  0.1104720  0.4800 0.6312806    \ntime_to_treatment11   0.1006348  0.0976293  1.0308 0.3027313    \ntime_to_treatment12   0.1215560  0.1316073  0.9236 0.3557611    \ntime_to_treatment13   0.1181285  0.1109439  1.0648 0.2870776    \ntime_to_treatment14   0.1449415  0.1527482  0.9489 0.3427582    \nenrol                -0.2065358  0.0276141 -7.4794 9.961e-14 ***\nyeduc                 0.0602555  0.0129976  4.6359 3.718e-06 ***\nexp                   0.1228576  0.0253533  4.8458 1.330e-06 ***\nI(exp^2)             -0.0022192  0.0008226 -2.6977 0.0070235 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nTotal Sum of Squares:    365.67\nResidual Sum of Squares: 318.32\nR-Squared:      0.12949\nAdj. R-Squared: 0.028553\nF-statistic: 7.31333 on 37 and 2777 DF, p-value: &lt; 2.22e-16"
  },
  {
    "objectID": "03_Estimators2.html#fe-with-dummy-impact-function-3",
    "href": "03_Estimators2.html#fe-with-dummy-impact-function-3",
    "title": "Panel Data Estimators 2",
    "section": "FE with Dummy impact function",
    "text": "FE with Dummy impact function\n\n\nCode\n# Adjusting the results matrix setup to include all marcount levels\ncoef.df &lt;- data.frame(time = factor(c(-4:7), levels = c(-4:7)),\n                      # Include all levels as factors\n                      att = NA,\n                      se = NA)\n\n# Extracting coefficients and SEs for marcount levels\noutput &lt;- summary(fe_dummy)$coefficients\nfor (i in levels(coef.df$time)) {\n  coef_name &lt;- paste0(\"time_to_treatment\", i)\n  if (coef_name %in% rownames(output)) {\n    coef.df[coef.df$time == i, c(\"att\", \"se\")] &lt;- output[coef_name, 1:2]\n  }\n}\n\n# Fill reference category\ncoef.df$att[coef.df$time == control[1]] &lt;- 0\ncoef.df$se[coef.df$time == control[1]] &lt;- 0\n\ncoef.df$model &lt;- \"TWFE Event-Study Design\"\n\ncoef.df$time2 &lt;- as.numeric(as.character(coef.df$time))\n\n# Calculate 95% CI\ninterval2 &lt;- -qnorm((1 - 0.95) / 2)\ncoef.df$ll &lt;- coef.df$att - coef.df$se * interval2\ncoef.df$ul &lt;- coef.df$att + coef.df$se * interval2\n\n# Pre vs post\ncoef.df$post &lt;- ifelse(coef.df$time2 &gt;= 0, 1, 0)\ncoef.df$post &lt;- factor(coef.df$post, labels = c(\"Before treatment\",\n                                                          \"After treatment\"))\n\n# Plot\nzp &lt;- ggplot(coef.df, aes(x = time, y = att)) +\n  geom_hline(yintercept = 0) +\n  geom_vline(xintercept = 4.5, linetype = \"dashed\") +\n  geom_pointrange(data = coef.df,\n                  aes(\n                    x = time,\n                    y = att,\n                    ymin = ll,\n                    ymax = ul,\n                    color = post,\n                    shape = post\n                  )) +\n  scale_color_viridis_d(\n    option = \"B\",\n    end = 0.80,\n    begin = 0.2,\n    direction = -1\n  ) +\n  theme_minimal() + theme(\n    panel.grid.minor = element_blank(),\n    text = element_text(family = \"Times New Roman\", size = 16),\n    axis.text = element_text(colour = \"black\"),\n    legend.position = \"bottom\",\n    legend.title = element_blank()\n  ) +\n  scale_x_discrete() +\n  labs(x = \"Event time (Year of marriage = 0)\",\n       y = paste0(\"Effect on ln Wage\"))\n\nzp\n\n\n\nCode\n# save mwp\nmwp_new &lt;- mwp"
  },
  {
    "objectID": "03_Estimators2.html#diff-in-diff",
    "href": "03_Estimators2.html#diff-in-diff",
    "title": "Panel Data Estimators 2",
    "section": "Diff-in-Diff",
    "text": "Diff-in-Diff\n\nDiff-in-Diff design, adopted from Cunningham (2021)"
  },
  {
    "objectID": "03_Estimators2.html#diff-in-diff-1",
    "href": "03_Estimators2.html#diff-in-diff-1",
    "title": "Panel Data Estimators 2",
    "section": "Diff-in-Diff",
    "text": "Diff-in-Diff\nThe difference-in-differences (Diff-in-Diff) design is a simple yet powerful approach to evaluating the impact of a treatment in a panel data setting. In its basic form, the \\(2 \\times 2\\) Diff-in-Diff estimator involves two groups—treatment (\\(T\\)) and control (\\(C\\))—observed at two time points, before and after the treatment.\nIn this setup, the treatment is uniform across observations and occurs at the same time. Diff-in-Diff is thus equivalent to two-ways FE."
  },
  {
    "objectID": "03_Estimators2.html#diff-in-diff-2",
    "href": "03_Estimators2.html#diff-in-diff-2",
    "title": "Panel Data Estimators 2",
    "section": "Diff-in-Diff",
    "text": "Diff-in-Diff\nThe situation becomes more intricate with multiple time periods and when the treatment timing varies and when treatment effects are dynamic - i.e they follow a temporal pattern.\nSeveral econometric papers on this topic (Borusyak, Jaravel, and Spiess 2023; Callaway and Sant’Anna 2021; De Chaisemartin and D’Haultfœuille 2020; Goodman-Bacon 2021; Sun and Abraham 2021) have recently changed peoples (or at least economists) views on twoway FE."
  },
  {
    "objectID": "03_Estimators2.html#fe-and-diff-in-diff",
    "href": "03_Estimators2.html#fe-and-diff-in-diff",
    "title": "Panel Data Estimators 2",
    "section": "FE and Diff-in-Diff",
    "text": "FE and Diff-in-Diff\nWith multiple time-periods, Goodman-Bacon (2021) has demonstrated that Twoway Fixed Effects (TWFE) can be seen as a weighted average of all possible \\(2 \\times 2\\) Diff-in-Diff estimators.\nThe weights are influenced by\n\nthe group size\ntreatment variance within each subgroup (how long we observe each combination before and after treatment)"
  },
  {
    "objectID": "03_Estimators2.html#fe-and-diff-in-diff-1",
    "href": "03_Estimators2.html#fe-and-diff-in-diff-1",
    "title": "Panel Data Estimators 2",
    "section": "FE and Diff-in-Diff",
    "text": "FE and Diff-in-Diff\nIn many settings — particularly when treatment effects are homogeneous, which would be the case if all individuals experience the same static treatment effect — this is not a problem at all. TWFE will give the correct results.\nHowever, two-way FE may produce biased results when treatment effects are dynamic over time and treatment timing varies (Roth et al. 2023)."
  },
  {
    "objectID": "03_Estimators2.html#whats-the-problem",
    "href": "03_Estimators2.html#whats-the-problem",
    "title": "Panel Data Estimators 2",
    "section": "What’s the problem?",
    "text": "What’s the problem?\n\nTrend-breaking treatment"
  },
  {
    "objectID": "03_Estimators2.html#whats-the-problem-1",
    "href": "03_Estimators2.html#whats-the-problem-1",
    "title": "Panel Data Estimators 2",
    "section": "What’s the problem?",
    "text": "What’s the problem?\n\nInverse U-shaped treatment"
  },
  {
    "objectID": "03_Estimators2.html#the-forbidden-comparison",
    "href": "03_Estimators2.html#the-forbidden-comparison",
    "title": "Panel Data Estimators 2",
    "section": "The forbidden comparison",
    "text": "The forbidden comparison\n\nForbidden comparison"
  },
  {
    "objectID": "03_Estimators2.html#potential-solutions",
    "href": "03_Estimators2.html#potential-solutions",
    "title": "Panel Data Estimators 2",
    "section": "Potential solutions",
    "text": "Potential solutions\nSeveral authors have proposed solutions (Callaway and Sant’Anna 2021; De Chaisemartin and D’Haultfœuille 2020; Borusyak, Jaravel, and Spiess 2023; Sun and Abraham 2021; Wooldridge 2021) by using dynamic Difference-in-Differences estimators.\nFor a review of these estimators, see, for instance, Roth et al. (2023) or Rüttenauer and Aksoy (2024)."
  },
  {
    "objectID": "03_Estimators2.html#potential-solutions-1",
    "href": "03_Estimators2.html#potential-solutions-1",
    "title": "Panel Data Estimators 2",
    "section": "Potential solutions",
    "text": "Potential solutions\nThe idea of these estimators can be described as (parametrically or non-parametrically) estimating several \\(2 \\times 2\\) Diff-in-Diffs.\nIn a multi-group and heterogeneous treatment-timing setting, we compute group-time average treatment effects by grouping all treatment units that receive treatment at the same period into a common group \\(g\\)."
  },
  {
    "objectID": "03_Estimators2.html#dynamic-diff-in-diff",
    "href": "03_Estimators2.html#dynamic-diff-in-diff",
    "title": "Panel Data Estimators 2",
    "section": "Dynamic Diff-in-Diff",
    "text": "Dynamic Diff-in-Diff\nFor each treatment group \\(g\\) and time period \\(t\\), we estimate group-specific and time-specific ATTs:\n\\[\n\\begin{align}\n\\delta_{g,t} & = \\mathrm{E}(\\Delta y_{g}) - \\mathrm{E}(\\Delta y_{C})\\\\\n&= (\\mathrm{E}(y_{g}^{t}) - \\mathrm{E}(y_{g}^{g-1})) - (\\mathrm{E}(y_{C}^{t}) - \\mathrm{E}(y_{C}^{g-1})),\n\\end{align}\n\\]\nwhere the control group can either be the never-treated or the not-yet-treated."
  },
  {
    "objectID": "03_Estimators2.html#dynamic-diff-in-diff-1",
    "href": "03_Estimators2.html#dynamic-diff-in-diff-1",
    "title": "Panel Data Estimators 2",
    "section": "Dynamic Diff-in-Diff",
    "text": "Dynamic Diff-in-Diff\n\nEstimator by Callaway and Sant’Anna (2021)"
  },
  {
    "objectID": "03_Estimators2.html#time-specific-averages",
    "href": "03_Estimators2.html#time-specific-averages",
    "title": "Panel Data Estimators 2",
    "section": "Time-specific averages",
    "text": "Time-specific averages\nThis obviously yields a large number of different treatment effects. But we can combine them, e.g. by\n\\[\n  \\theta_D(e) := \\sum_{g=1}^G \\mathbf{1} \\{ g + e \\leq T \\} \\delta(g,g+e) P(G=g | G+e \\leq T),\n\\]\nwhere \\(e\\) specifies for how long a unit has been exposed to the treatment. It is basically the average effects across all treatment-timing groups at the period \\(e\\) after treatment."
  },
  {
    "objectID": "03_Estimators2.html#assumptions",
    "href": "03_Estimators2.html#assumptions",
    "title": "Panel Data Estimators 2",
    "section": "Assumptions",
    "text": "Assumptions\n\nStaggered treatment adoption: once treated, a unit remains treated\nParallel trends assumption\n\n\nbased on never-treated (very strong)\nbased on not-yet-treated (a bit more likely)\n\n\nNo treatment anticipation\n\n\nbased on never-treated (a bit more likely)\nbased on not-yet-treated (very strong)"
  },
  {
    "objectID": "03_Estimators2.html#assumptions-1",
    "href": "03_Estimators2.html#assumptions-1",
    "title": "Panel Data Estimators 2",
    "section": "Assumptions",
    "text": "Assumptions\nTrade-off: If assumption 2) is likely to hold, we can use only the never-treated as controls to relax assumption 3). If assumption 3) is likely to hold, we can include the not-yet-treated as control to relax assumption 2)."
  },
  {
    "objectID": "03_Estimators2.html#dynamic-diff-in-diff-2",
    "href": "03_Estimators2.html#dynamic-diff-in-diff-2",
    "title": "Panel Data Estimators 2",
    "section": "Dynamic Diff-in-Diff",
    "text": "Dynamic Diff-in-Diff\n\n\n\n\n\n\nNote\n\n\nThe estimator of Callaway and Sant’Anna (2021) uses a single period before treatment (by default it’s the year before treatment) as pre-treatment period for many \\(2\\times 2\\) Diff-in-Diff estimators. The estimator is thus sensitive to anticipation.\nIn contrast, Borusyak, Jaravel, and Spiess (2023) uses all pre-treatment periods as control periods. It thus less sensitive to anticipation, but more sensitive to violations of parallel trends."
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage-1",
    "href": "03_Estimators2.html#example---marriage-and-wage-1",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage\nAs an example, we use the mwp panel data, containing information on wages and family status of 268 men.\nWe exemplary investigate the ‘marriage wage premium’: we analyse whether marriage leads to an increase in the hourly wage for men."
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage-2",
    "href": "03_Estimators2.html#example---marriage-and-wage-2",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage\n\nlibrary(feisr)\ndata(\"mwp\", package = \"feisr\")\nhead(mwp)\n\n  id year      lnw      exp      expq marry evermarry enrol yeduc age cohort\n1  1 1981 1.934358 1.076923  1.159763     0         1     1    11  18   1963\n2  1 1983 2.468140 3.019231  9.115755     0         1     1    12  20   1963\n3  1 1984 2.162480 4.038462 16.309174     0         1     1    12  21   1963\n4  1 1985 1.746280 5.076923 25.775146     0         1     0    12  22   1963\n5  1 1986 2.527840 6.096154 37.163090     0         1     1    13  23   1963\n6  1 1987 2.365361 7.500000 56.250000     0         1     1    13  24   1963\n  yeargr yeargr1 yeargr2 yeargr3 yeargr4 yeargr5\n1      2       0       1       0       0       0\n2      2       0       1       0       0       0\n3      2       0       1       0       0       0\n4      2       0       1       0       0       0\n5      3       0       0       1       0       0\n6      3       0       0       1       0       0"
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage-3",
    "href": "03_Estimators2.html#example---marriage-and-wage-3",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage\n\n# treatment timing = year if married\nmwp$treat_timing &lt;- ifelse(mwp$marry == 1, mwp$year, NA)\n\n# set never treated to zero\nmwp$treat_timing[mwp$evermarry == 0] &lt;- 0\n\n# if married is not NA, used min year per id (removing NAs)\nmwp$treat_timing[!is.na(mwp$marry)] &lt;- ave(mwp$treat_timing[!is.na(mwp$marry)],\n                                           mwp$id[!is.na(mwp$marry)],\n                                           FUN = function(x) min(x, na.rm = TRUE))"
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage-4",
    "href": "03_Estimators2.html#example---marriage-and-wage-4",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage\n\n# treatment timing = year if married\nmwp$treat_timing &lt;- ifelse(mwp$marry == 1, mwp$year, NA)\n\n# set never treated to zero\nmwp$treat_timing[mwp$evermarry == 0] &lt;- 0\n\n# if married is not NA, used min year per id (removing NAs)\nmwp$treat_timing[!is.na(mwp$marry)] &lt;- ave(mwp$treat_timing[!is.na(mwp$marry)],\n                                           mwp$id[!is.na(mwp$marry)],\n                                           FUN = function(x) min(x, na.rm = TRUE))"
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage-5",
    "href": "03_Estimators2.html#example---marriage-and-wage-5",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage\n\n# treatment timing = year if married\nmwp$treat_timing &lt;- ifelse(mwp$marry == 1, mwp$year, NA)\n\n# set never treated to zero\nmwp$treat_timing[mwp$evermarry == 0] &lt;- 0\n\n# if married is not NA, used min year per id (removing NAs)\nmwp$treat_timing[!is.na(mwp$marry)] &lt;- ave(mwp$treat_timing[!is.na(mwp$marry)],\n                                           mwp$id[!is.na(mwp$marry)],\n                                           FUN = function(x) min(x, na.rm = TRUE))"
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage-6",
    "href": "03_Estimators2.html#example---marriage-and-wage-6",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage\n\nhead(mwp[, c(\"id\", \"year\", \"marry\", \"evermarry\", \"treat_timing\")], n = 35)\n\n   id year marry evermarry treat_timing\n1   1 1981     0         1         1988\n2   1 1983     0         1         1988\n3   1 1984     0         1         1988\n4   1 1985     0         1         1988\n5   1 1986     0         1         1988\n6   1 1987     0         1         1988\n7   1 1988     1         1         1988\n8   1 1989     1         1         1988\n9   1 1990     1         1         1988\n10  1 1991     1         1         1988\n11  1 1992     1         1         1988\n12  2 1979     0         0            0\n13  2 1981     0         0            0\n14  2 1982     0         0            0\n15  2 1983     0         0            0\n16  2 1984     0         0            0\n17  2 1985     0         0            0\n18  2 1989     0         0            0\n19  3 1979     0         0            0\n20  3 1980     0         0            0\n21  3 1981     0         0            0\n22  3 1982     0         0            0\n23  3 1983     0         0            0\n24  3 1984     0         0            0\n25  3 1985     0         0            0\n26  3 1986     0         0            0\n27  3 1987     0         0            0\n28  3 1988     0         0            0\n29  3 1989     0         0            0\n30  3 1993     0         0            0\n31  3 1994     0         0            0\n32  3 2000     0         0            0\n33  4 1979     0         1         1982\n34  4 1981     0         1         1982\n35  4 1982     1         1         1982"
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage-7",
    "href": "03_Estimators2.html#example---marriage-and-wage-7",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage\nUsing the package did.\n\nlibrary(did)\n# estimate group-time average treatment effects using att_gt method\nwages.attgt &lt;- att_gt(yname = \"lnw\",\n                      tname = \"year\",\n                      idname = \"id\",\n                      gname = \"treat_timing\",\n                      xformla = ~ enrol + yeduc + exp + I(exp^2), \n                      data = mwp,\n                      control_group = \"notyettreated\",\n                      anticipation = 0,\n                      allow_unbalanced_panel = TRUE,\n                      est_method = \"ipw\"\n                        )"
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage-8",
    "href": "03_Estimators2.html#example---marriage-and-wage-8",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage\nUsing the package did.\n\nlibrary(did)\n# estimate group-time average treatment effects using att_gt method\nwages.attgt &lt;- att_gt(yname = \"lnw\",\n                      tname = \"year\",\n                      idname = \"id\",\n                      gname = \"treat_timing\",\n                      xformla = ~ enrol + yeduc + exp + I(exp^2), # note that we omit the yeargroup here\n                      data = mwp,\n                      control_group = \"notyettreated\",\n                      anticipation = 0,\n                      allow_unbalanced_panel = TRUE,\n                      est_method = \"ipw\",\n                        )"
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage-9",
    "href": "03_Estimators2.html#example---marriage-and-wage-9",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage\nUsing the package did.\n\nlibrary(did)\n# estimate group-time average treatment effects using att_gt method\nwages.attgt &lt;- att_gt(yname = \"lnw\",\n                      tname = \"year\",\n                      idname = \"id\",\n                      gname = \"treat_timing\",\n                      xformla = ~ enrol + yeduc + exp + I(exp^2), # note that we omit the yeargroup here\n                      data = mwp,\n                      control_group = \"notyettreated\",\n                      anticipation = 0,\n                      allow_unbalanced_panel = TRUE,\n                      est_method = \"ipw\"\n                        )"
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage-10",
    "href": "03_Estimators2.html#example---marriage-and-wage-10",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage\nUsing the package did.\n\nlibrary(did)\n# estimate group-time average treatment effects using att_gt method\nwages.attgt &lt;- att_gt(yname = \"lnw\",\n                      tname = \"year\",\n                      idname = \"id\",\n                      gname = \"treat_timing\",\n                      xformla = ~ enrol + yeduc + exp + I(exp^2), # note that we omit the yeargroup here\n                      data = mwp,\n                      control_group = \"notyettreated\",\n                      anticipation = 0,\n                      allow_unbalanced_panel = TRUE,\n                      est_method = \"ipw\"\n                        )"
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage-11",
    "href": "03_Estimators2.html#example---marriage-and-wage-11",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage\nUsing the package did.\n\nlibrary(did)\n# estimate group-time average treatment effects using att_gt method\nwages.attgt &lt;- att_gt(yname = \"lnw\",\n                      tname = \"year\",\n                      idname = \"id\",\n                      gname = \"treat_timing\",\n                      xformla = ~ enrol + yeduc + exp + I(exp^2), # note that we omit the yeargroup here\n                      data = mwp,\n                      control_group = \"notyettreated\",\n                      anticipation = 0,\n                      allow_unbalanced_panel = TRUE,\n                      est_method = \"ipw\"\n                        )"
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage-12",
    "href": "03_Estimators2.html#example---marriage-and-wage-12",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage\nAnd we get a lot of individual treatment effects.\n\n# Show the group-time specific estimates\nsummary(wages.attgt)\n\n\nCall:\natt_gt(yname = \"lnw\", tname = \"year\", idname = \"id\", gname = \"treat_timing\", \n    xformla = ~enrol + yeduc + exp + I(exp^2), data = mwp, allow_unbalanced_panel = TRUE, \n    control_group = \"notyettreated\", anticipation = 0, est_method = \"ipw\")\n\nReference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. &lt;https://doi.org/10.1016/j.jeconom.2020.12.001&gt;, &lt;https://arxiv.org/abs/1803.09015&gt; \n\nGroup-Time Average Treatment Effects:\n Group Time ATT(g,t) Std. Error [95% Simult.  Conf. Band]  \n  1980 1980   0.0628     0.1690       -0.5946      0.7201  \n  1980 1981   0.0681     0.2408       -0.8684      1.0045  \n  1980 1982   0.1250     0.1628       -0.5082      0.7582  \n  1980 1983  -0.0151     0.2608       -1.0295      0.9993  \n  1980 1984   0.1353     0.1339       -0.3854      0.6560  \n  1980 1985   0.1432     0.1169       -0.3116      0.5980  \n  1980 1986  -0.0074     0.1270       -0.5012      0.4864  \n  1980 1987  -0.0201     0.1473       -0.5928      0.5526  \n  1980 1988  -0.2640     0.1727       -0.9357      0.4077  \n  1980 1989  -0.2268     0.2088       -1.0386      0.5851  \n  1980 1990  -0.1624     0.2171       -1.0067      0.6819  \n  1980 1991  -0.0230     0.2056       -0.8226      0.7766  \n  1980 1992  -0.0751     0.2747       -1.1435      0.9933  \n  1980 1993   0.1777     0.3040       -1.0045      1.3598  \n  1980 1994  -0.4508     0.2014       -1.2339      0.3322  \n  1980 1996       NA         NA            NA          NA  \n  1980 1998       NA         NA            NA          NA  \n  1980 2000       NA         NA            NA          NA  \n  1981 1980  -0.1158     0.1173       -0.5721      0.3405  \n  1981 1981   0.1273     0.0867       -0.2099      0.4646  \n  1981 1982   0.1400     0.1286       -0.3601      0.6400  \n  1981 1983   0.0047     0.1308       -0.5041      0.5134  \n  1981 1984   0.0331     0.1439       -0.5264      0.5926  \n  1981 1985  -0.0885     0.1397       -0.6318      0.4549  \n  1981 1986  -0.1176     0.1157       -0.5676      0.3325  \n  1981 1987  -0.0066     0.1353       -0.5327      0.5195  \n  1981 1988  -0.1238     0.1344       -0.6463      0.3988  \n  1981 1989  -0.1627     0.1416       -0.7133      0.3879  \n  1981 1990  -0.0647     0.1539       -0.6631      0.5337  \n  1981 1991  -0.0346     0.1504       -0.6195      0.5503  \n  1981 1992   0.0308     0.1264       -0.4608      0.5224  \n  1981 1993   0.3283     0.2522       -0.6526      1.3092  \n  1981 1994  -0.2639     0.2914       -1.3970      0.8692  \n  1981 1996       NA         NA            NA          NA  \n  1981 1998       NA         NA            NA          NA  \n  1981 2000       NA         NA            NA          NA  \n  1982 1980  -0.1537     0.2019       -0.9387      0.6313  \n  1982 1981   0.3496     0.1522       -0.2424      0.9415  \n  1982 1982   0.1904     0.1676       -0.4616      0.8424  \n  1982 1983   0.2862     0.1478       -0.2884      0.8608  \n  1982 1984   0.0737     0.1631       -0.5608      0.7082  \n  1982 1985   0.3109     0.1687       -0.3453      0.9671  \n  1982 1986   0.0330     0.2034       -0.7578      0.8239  \n  1982 1987   0.2263     0.2035       -0.5652      1.0177  \n  1982 1988   0.0867     0.1926       -0.6624      0.8358  \n  1982 1989   0.2918     0.2187       -0.5588      1.1423  \n  1982 1990   0.1162     0.1954       -0.6439      0.8763  \n  1982 1991   0.3624     0.1752       -0.3191      1.0440  \n  1982 1992   0.3762     0.1988       -0.3971      1.1495  \n  1982 1993   0.4379     0.1732       -0.2355      1.1113  \n  1982 1994       NA         NA            NA          NA  \n  1982 1996       NA         NA            NA          NA  \n  1982 1998       NA         NA            NA          NA  \n  1982 2000       NA         NA            NA          NA  \n  1983 1980   0.0591     0.0932       -0.3033      0.4215  \n  1983 1981  -0.0588     0.0843       -0.3867      0.2692  \n  1983 1982   0.0991     0.0791       -0.2085      0.4067  \n  1983 1983  -0.0406     0.1007       -0.4321      0.3509  \n  1983 1984  -0.0747     0.0974       -0.4534      0.3040  \n  1983 1985  -0.0342     0.1076       -0.4528      0.3844  \n  1983 1986   0.0187     0.1334       -0.5000      0.5374  \n  1983 1987   0.0200     0.1697       -0.6400      0.6800  \n  1983 1988  -0.2116     0.1547       -0.8131      0.3899  \n  1983 1989  -0.1602     0.1412       -0.7094      0.3890  \n  1983 1990  -0.2118     0.1447       -0.7745      0.3509  \n  1983 1991  -0.0767     0.1579       -0.6910      0.5376  \n  1983 1992  -0.0682     0.1686       -0.7239      0.5875  \n  1983 1993   0.0888     0.1998       -0.6884      0.8661  \n  1983 1994  -0.0085     0.2663       -1.0441      1.0270  \n  1983 1996   0.0266     0.2167       -0.8160      0.8693  \n  1983 1998       NA         NA            NA          NA  \n  1983 2000       NA         NA            NA          NA  \n  1984 1980   0.2117     0.0777       -0.0906      0.5140  \n  1984 1981  -0.1813     0.2084       -0.9918      0.6292  \n  1984 1982   0.5052     0.2123       -0.3206      1.3310  \n  1984 1983  -0.1515     0.1228       -0.6292      0.3262  \n  1984 1984  -0.2544     0.3507       -1.6183      1.1096  \n  1984 1985   0.1233     0.1186       -0.3382      0.5847  \n  1984 1986   0.1043     0.1556       -0.5007      0.7092  \n  1984 1987  -0.0683     0.2680       -1.1107      0.9741  \n  1984 1988   0.0827     0.2565       -0.9147      1.0800  \n  1984 1989   0.1216     0.1035       -0.2811      0.5243  \n  1984 1990   0.1437     0.1522       -0.4484      0.7357  \n  1984 1991   0.2312     0.1113       -0.2018      0.6642  \n  1984 1992   0.3085     0.1271       -0.1856      0.8026  \n  1984 1993   0.2173     0.1503       -0.3673      0.8020  \n  1984 1994   0.1435     0.2357       -0.7732      1.0601  \n  1984 1996   0.1999     0.1867       -0.5264      0.9261  \n  1984 1998   0.1773     0.1909       -0.5651      0.9196  \n  1984 2000       NA         NA            NA          NA  \n  1985 1980   0.0090     0.1841       -0.7069      0.7248  \n  1985 1981  -0.0647     0.1437       -0.6236      0.4942  \n  1985 1982   0.0360     0.1258       -0.4534      0.5254  \n  1985 1983  -0.0195     0.0827       -0.3413      0.3023  \n  1985 1984  -0.0100     0.0893       -0.3574      0.3373  \n  1985 1985  -0.0587     0.0632       -0.3044      0.1870  \n  1985 1986   0.0078     0.0899       -0.3416      0.3573  \n  1985 1987   0.0363     0.1128       -0.4023      0.4750  \n  1985 1988   0.0500     0.1110       -0.3819      0.4818  \n  1985 1989   0.0450     0.1348       -0.4792      0.5692  \n  1985 1990   0.0118     0.1582       -0.6034      0.6270  \n  1985 1991   0.0156     0.1647       -0.6250      0.6563  \n  1985 1992   0.1572     0.1872       -0.5710      0.8854  \n  1985 1993   0.3310     0.2150       -0.5053      1.1673  \n  1985 1994   0.1684     0.2285       -0.7201      1.0569  \n  1985 1996  -0.1248     0.1997       -0.9014      0.6517  \n  1985 1998   0.0818     0.2848       -1.0260      1.1895  \n  1985 2000       NA         NA            NA          NA  \n  1986 1980  -0.0429     0.1844       -0.7598      0.6741  \n  1986 1981   0.1229     0.1807       -0.5798      0.8255  \n  1986 1982  -0.0840     0.1613       -0.7114      0.5434  \n  1986 1983  -0.1743     0.1228       -0.6518      0.3033  \n  1986 1984   0.0168     0.1721       -0.6523      0.6859  \n  1986 1985  -0.0209     0.0892       -0.3677      0.3260  \n  1986 1986  -0.1674     0.0887       -0.5122      0.1774  \n  1986 1987   0.0071     0.0987       -0.3767      0.3909  \n  1986 1988   0.0217     0.1200       -0.4450      0.4884  \n  1986 1989  -0.3083     0.1640       -0.9460      0.3295  \n  1986 1990  -0.1437     0.1498       -0.7264      0.4389  \n  1986 1991  -0.1661     0.1747       -0.8457      0.5135  \n  1986 1992  -0.1334     0.1857       -0.8558      0.5889  \n  1986 1993  -0.2491     0.2422       -1.1910      0.6929  \n  1986 1994  -0.1565     0.2762       -1.2305      0.9175  \n  1986 1996  -0.3710     0.4064       -1.9515      1.2096  \n  1986 1998  -0.5051     0.5762       -2.7458      1.7356  \n  1986 2000   0.1671     0.2829       -0.9330      1.2672  \n  1987 1980  -0.1499     0.1365       -0.6806      0.3808  \n  1987 1981  -0.0861     0.1340       -0.6074      0.4352  \n  1987 1982  -0.2023     0.1567       -0.8119      0.4073  \n  1987 1983  -0.0348     0.0956       -0.4066      0.3370  \n  1987 1984   0.0346     0.1856       -0.6872      0.7565  \n  1987 1985   0.3917     0.1540       -0.2072      0.9906  \n  1987 1986   0.1063     0.0938       -0.2586      0.4711  \n  1987 1987  -0.1017     0.1504       -0.6865      0.4831  \n  1987 1988  -0.0890     0.1157       -0.5389      0.3610  \n  1987 1989  -0.0433     0.1228       -0.5209      0.4342  \n  1987 1990  -0.0770     0.1321       -0.5909      0.4369  \n  1987 1991   0.0139     0.1144       -0.4311      0.4589  \n  1987 1992   0.0731     0.1260       -0.4169      0.5632  \n  1987 1993   0.1278     0.1534       -0.4687      0.7244  \n  1987 1994   0.0566     0.1800       -0.6434      0.7566  \n  1987 1996  -0.0039     0.1369       -0.5364      0.5286  \n  1987 1998   0.1258     0.1546       -0.4755      0.7271  \n  1987 2000  -0.0260     0.1795       -0.7242      0.6721  \n  1988 1980   0.1570     0.2595       -0.8522      1.1662  \n  1988 1981   0.1641     0.1469       -0.4073      0.7354  \n  1988 1982   0.0364     0.1513       -0.5520      0.6248  \n  1988 1983   0.0070     0.1286       -0.4931      0.5071  \n  1988 1984   0.0171     0.1094       -0.4083      0.4424  \n  1988 1985   0.1447     0.0970       -0.2324      0.5217  \n  1988 1986  -0.1751     0.1335       -0.6944      0.3442  \n  1988 1987  -0.0276     0.0874       -0.3676      0.3123  \n  1988 1988   0.1595     0.0752       -0.1331      0.4521  \n  1988 1989   0.3571     0.1307       -0.1511      0.8652  \n  1988 1990   0.3325     0.1058       -0.0788      0.7438  \n  1988 1991   0.3761     0.1045       -0.0305      0.7826  \n  1988 1992   0.2665     0.1210       -0.2041      0.7372  \n  1988 1993   0.3551     0.1262       -0.1358      0.8459  \n  1988 1994   0.2795     0.1781       -0.4130      0.9720  \n  1988 1996   0.2654     0.1337       -0.2544      0.7853  \n  1988 1998   0.0533     0.2577       -0.9490      1.0555  \n  1988 2000   0.0759     0.1335       -0.4431      0.5949  \n  1989 1980   0.0952     0.1795       -0.6029      0.7932  \n  1989 1981  -0.2540     0.2641       -1.2810      0.7731  \n  1989 1982   0.1641     0.2530       -0.8197      1.1479  \n  1989 1983  -0.0201     0.2687       -1.0651      1.0249  \n  1989 1984  -0.0434     0.1051       -0.4520      0.3653  \n  1989 1985  -0.3140     0.2197       -1.1686      0.5405  \n  1989 1986   0.0050     0.2733       -1.0577      1.0677  \n  1989 1987  -0.0560     0.1514       -0.6447      0.5327  \n  1989 1988   0.1015     0.1170       -0.3534      0.5565  \n  1989 1989  -0.0139     0.1021       -0.4109      0.3831  \n  1989 1990  -0.0121     0.1126       -0.4501      0.4259  \n  1989 1991   0.0195     0.1511       -0.5680      0.6070  \n  1989 1992   0.2149     0.2782       -0.8669      1.2968  \n  1989 1993  -0.0986     0.1913       -0.8427      0.6454  \n  1989 1994   0.0843     0.2755       -0.9871      1.1557  \n  1989 1996   0.0821     0.3902       -1.4352      1.5995  \n  1989 1998   0.2027     0.2909       -0.9285      1.3339  \n  1989 2000  -0.0984     0.3936       -1.6291      1.4322  \n  1990 1980   0.1804     0.2916       -0.9537      1.3146  \n  1990 1981   0.0157     0.2262       -0.8639      0.8952  \n  1990 1982  -0.2091     0.3064       -1.4008      0.9826  \n  1990 1983   0.4847     0.1985       -0.2874      1.2567  \n  1990 1984   0.5393     0.2601       -0.4723      1.5509  \n  1990 1985  -0.5270     0.2058       -1.3274      0.2734  \n  1990 1986  -0.2090     0.1864       -0.9338      0.5158  \n  1990 1987   0.0020     0.1918       -0.7438      0.7479  \n  1990 1988   0.0803     0.3348       -1.2216      1.3822  \n  1990 1989   0.0610     0.3100       -1.1447      1.2668  \n  1990 1990   0.1029     0.2335       -0.8053      1.0111  \n  1990 1991   0.1069     0.4013       -1.4540      1.6677  \n  1990 1992   0.2921     0.2433       -0.6542      1.2384  \n  1990 1993   0.3636     0.4357       -1.3308      2.0581  \n  1990 1994   0.2978     0.4146       -1.3145      1.9101  \n  1990 1996   0.2712     0.3584       -1.1225      1.6648  \n  1990 1998   0.3685     0.3779       -1.1011      1.8381  \n  1990 2000   0.2603     0.4684       -1.5615      2.0821  \n  1991 1980   0.1241     0.2993       -1.0399      1.2881  \n  1991 1981   0.2311     0.1437       -0.3278      0.7900  \n  1991 1982  -0.3164     0.2366       -1.2366      0.6038  \n  1991 1983   0.1718     0.1925       -0.5769      0.9205  \n  1991 1984  -0.3008     0.1375       -0.8355      0.2338  \n  1991 1985   0.3180     0.2224       -0.5469      1.1829  \n  1991 1986   0.0717     0.2471       -0.8895      1.0328  \n  1991 1987   0.0132     0.2540       -0.9746      1.0010  \n  1991 1988   0.0872     0.1641       -0.5509      0.7253  \n  1991 1989  -0.1509     0.1854       -0.8720      0.5702  \n  1991 1990   0.2471     0.1382       -0.2903      0.7844  \n  1991 1991  -0.0288     0.1050       -0.4370      0.3794  \n  1991 1992  -0.0136     0.1481       -0.5898      0.5626  \n  1991 1993  -0.0463     0.1470       -0.6180      0.5254  \n  1991 1994  -0.1002     0.1892       -0.8361      0.6357  \n  1991 1996  -0.2419     0.1930       -0.9924      0.5086  \n  1991 1998  -0.1121     0.1822       -0.8208      0.5965  \n  1991 2000  -0.3106     0.2125       -1.1372      0.5159  \n  1992 1980   0.0325     0.1839       -0.6825      0.7476  \n  1992 1981  -0.0126     0.1975       -0.7808      0.7556  \n  1992 1982   0.2404     0.1554       -0.3638      0.8445  \n  1992 1983  -0.0186     0.1240       -0.5010      0.4638  \n  1992 1984  -0.1611     0.1128       -0.5998      0.2777  \n  1992 1985   0.0593     0.1845       -0.6581      0.7767  \n  1992 1986  -0.0964     0.1833       -0.8092      0.6165  \n  1992 1987  -0.0754     0.2528       -1.0584      0.9076  \n  1992 1988   0.1278     0.1287       -0.3729      0.6285  \n  1992 1989  -0.0637     0.0799       -0.3745      0.2472  \n  1992 1990   0.1368     0.1174       -0.3198      0.5934  \n  1992 1991   0.1333     0.1393       -0.4086      0.6751  \n  1992 1992   0.1362     0.0906       -0.2161      0.4885  \n  1992 1993  -0.0629     0.1543       -0.6631      0.5372  \n  1992 1994  -0.0726     0.1494       -0.6537      0.5085  \n  1992 1996  -0.1803     0.1982       -0.9511      0.5906  \n  1992 1998  -0.0575     0.2097       -0.8729      0.7579  \n  1992 2000  -0.1101     0.1589       -0.7282      0.5081  \n  1993 1980   0.1776     0.1233       -0.3018      0.6570  \n  1993 1981  -0.1647     0.0678       -0.4284      0.0990  \n  1993 1982  -0.2508     0.2261       -1.1300      0.6284  \n  1993 1983   0.5942     0.2798       -0.4941      1.6825  \n  1993 1984  -0.2296     0.1441       -0.7900      0.3309  \n  1993 1985   0.3973     0.2519       -0.5823      1.3770  \n  1993 1986   0.0952     0.3361       -1.2119      1.4023  \n  1993 1987  -0.0469     0.2647       -1.0764      0.9826  \n  1993 1988  -0.0738     0.1063       -0.4873      0.3398  \n  1993 1989   0.0560     0.1030       -0.3444      0.4563  \n  1993 1990  -0.0782     0.0829       -0.4006      0.2442  \n  1993 1991  -0.0049     0.0906       -0.3571      0.3473  \n  1993 1992  -0.0107     0.1578       -0.6243      0.6030  \n  1993 1993  -0.1082     0.1731       -0.7815      0.5651  \n  1993 1994  -0.1348     0.1811       -0.8392      0.5697  \n  1993 1996   0.0149     0.1633       -0.6200      0.6498  \n  1993 1998  -0.0602     0.1988       -0.8333      0.7130  \n  1993 2000  -0.2439     0.2365       -1.1636      0.6758  \n  1994 1980       NA         NA            NA          NA  \n  1994 1981   0.2285     0.0973       -0.1500      0.6069  \n  1994 1982  -0.1200     0.1018       -0.5160      0.2760  \n  1994 1983   0.2712     0.1004       -0.1192      0.6616  \n  1994 1984  -0.3439     0.0636       -0.5912     -0.0965 *\n  1994 1985  -0.1302     0.1626       -0.7625      0.5021  \n  1994 1986   0.2635     0.2983       -0.8968      1.4237  \n  1994 1987   0.1851     0.3371       -1.1258      1.4961  \n  1994 1988   0.2031     0.1075       -0.2149      0.6211  \n  1994 1989  -0.0582     0.1309       -0.5673      0.4509  \n  1994 1990  -0.0163     0.1123       -0.4530      0.4204  \n  1994 1991   0.1098     0.0690       -0.1587      0.3784  \n  1994 1992   0.3781     0.1290       -0.1236      0.8797  \n  1994 1993  -0.3599     0.3028       -1.5376      0.8177  \n  1994 1994  -0.0310     0.2837       -1.1343      1.0723  \n  1994 1996   0.0600     0.1719       -0.6084      0.7284  \n  1994 1998  -0.2455     0.2852       -1.3546      0.8637  \n  1994 2000  -0.6118     0.3092       -1.8144      0.5907  \n  1996 1980  -0.4663     0.2751       -1.5363      0.6038  \n  1996 1981   0.1813     0.1667       -0.4671      0.8297  \n  1996 1982  -0.0115     0.1700       -0.6728      0.6498  \n  1996 1983  -0.3838     0.2465       -1.3423      0.5746  \n  1996 1984   0.2542     0.1313       -0.2564      0.7647  \n  1996 1985  -0.0829     0.2265       -0.9637      0.7978  \n  1996 1986  -0.1070     0.3029       -1.2848      1.0708  \n  1996 1987   0.4484     0.3408       -0.8769      1.7737  \n  1996 1988  -0.5384     0.3408       -1.8639      0.7871  \n  1996 1989   0.3131     0.2460       -0.6437      1.2700  \n  1996 1990  -0.1585     0.1871       -0.8862      0.5692  \n  1996 1991  -0.1210     0.1337       -0.6411      0.3992  \n  1996 1992  -0.0861     0.2560       -1.0818      0.9096  \n  1996 1993   0.3078     0.3819       -1.1773      1.7928  \n  1996 1994  -0.2208     0.3795       -1.6965      1.2550  \n  1996 1996   0.4384     0.2608       -0.5759      1.4526  \n  1996 1998   0.0598     0.2138       -0.7717      0.8912  \n  1996 2000  -0.1224     0.2689       -1.1682      0.9234  \n  1998 1980  -0.3103     0.1288       -0.8110      0.1904  \n  1998 1981   0.2343     0.1191       -0.2287      0.6973  \n  1998 1982   0.2493     0.1594       -0.3705      0.8691  \n  1998 1983  -0.1420     0.1760       -0.8264      0.5423  \n  1998 1984   0.0598     0.1118       -0.3748      0.4945  \n  1998 1985  -0.2475     0.1041       -0.6523      0.1573  \n  1998 1986   0.4092     0.1597       -0.2121      1.0304  \n  1998 1987  -0.1969     0.1527       -0.7907      0.3970  \n  1998 1988   0.3569     0.1088       -0.0663      0.7801  \n  1998 1989  -0.1676     0.4304       -1.8414      1.5062  \n  1998 1990  -0.2315     0.3589       -1.6273      1.1643  \n  1998 1991   0.1584     0.1582       -0.4567      0.7735  \n  1998 1992  -0.0363     0.1819       -0.7438      0.6712  \n  1998 1993  -0.0692     0.1268       -0.5625      0.4240  \n  1998 1994   0.4389     0.3927       -1.0883      1.9661  \n  1998 1996  -0.4187     0.3532       -1.7923      0.9549  \n  1998 1998  -0.0439     0.1629       -0.6773      0.5896  \n  1998 2000   0.1527     0.3434       -1.1826      1.4881  \n---\nSignif. codes: `*' confidence band does not cover 0\n\nP-value for pre-test of parallel trends assumption:  0\nControl Group:  Not Yet Treated,  Anticipation Periods:  0\nEstimation Method:  Inverse Probability Weighting"
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage-13",
    "href": "03_Estimators2.html#example---marriage-and-wage-13",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage\nTo make this more interpretable, we re-aggregate the individuals results to a dynamic time-averaged effect (we now restrict this to observations from -3 to 6).\n\nwages.dyn &lt;- aggte(wages.attgt, type = \"dynamic\", na.rm = TRUE,\n                   min_e = -3, max_e = 6)\nsummary(wages.dyn)\n\n\nCall:\naggte(MP = wages.attgt, type = \"dynamic\", min_e = -3, max_e = 6, \n    na.rm = TRUE)\n\nReference: Callaway, Brantly and Pedro H.C. Sant'Anna.  \"Difference-in-Differences with Multiple Time Periods.\" Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. &lt;https://doi.org/10.1016/j.jeconom.2020.12.001&gt;, &lt;https://arxiv.org/abs/1803.09015&gt; \n\n\nOverall summary of ATT's based on event-study/dynamic aggregation:  \n    ATT    Std. Error     [ 95%  Conf. Int.] \n 0.0438        0.0419    -0.0384       0.126 \n\n\nDynamic Effects:\n Event time Estimate Std. Error [95% Simult.  Conf. Band] \n         -3   0.0333     0.0494       -0.0958      0.1625 \n         -2   0.0152     0.0476       -0.1093      0.1396 \n         -1   0.0314     0.0355       -0.0614      0.1242 \n          0   0.0088     0.0389       -0.0929      0.1105 \n          1   0.0484     0.0403       -0.0569      0.1538 \n          2   0.0711     0.0420       -0.0386      0.1809 \n          3   0.0704     0.0526       -0.0670      0.2079 \n          4   0.0270     0.0549       -0.1165      0.1704 \n          5   0.0322     0.0595       -0.1232      0.1876 \n          6   0.0488     0.0635       -0.1172      0.2148 \n---\nSignif. codes: `*' confidence band does not cover 0\n\nControl Group:  Not Yet Treated,  Anticipation Periods:  0\nEstimation Method:  Inverse Probability Weighting"
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage-14",
    "href": "03_Estimators2.html#example---marriage-and-wage-14",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage\nThe did package also comes with a handy command ggdid() to plot the results\n\nzp3 &lt;- ggdid(wages.dyn) \n  \nzp3 &lt;- zp3 + \n  geom_hline(yintercept = 0, colour = gray(1/2), lty = 2) +\n  geom_vline(xintercept = -0.5, colour = \"black\", lty = 1)\n\nzp3"
  },
  {
    "objectID": "03_Estimators2.html#example---marriage-and-wage-15",
    "href": "03_Estimators2.html#example---marriage-and-wage-15",
    "title": "Panel Data Estimators 2",
    "section": "Example - Marriage and wage",
    "text": "Example - Marriage and wage"
  },
  {
    "objectID": "03_Estimators2.html#you-could-do-it-in-a-loop",
    "href": "03_Estimators2.html#you-could-do-it-in-a-loop",
    "title": "Panel Data Estimators 2",
    "section": "You could do it in a loop",
    "text": "You could do it in a loop\nThese individual effects are similar to running a lot of individual regressions, where we compute a lot of individual \\(2 \\times 2\\) DD estimators, e.g. for group 1981:\n\nt &lt;- 1981\n\n# run individual effects\nfor(i in sort(unique(mwp$year))[-1]){\n  \n  # not yet treated\n  mwp$notyettreated &lt;- ifelse(mwp$treat_timing &gt; t & mwp$treat_timing &gt; i, 1, 0)\n  \n  # select 1980 group, never-treated and not yet treated\n  oo &lt;- which(mwp$treat_timing == t | mwp$treat_timing == 0 | mwp$notyettreated == 1)\n  df &lt;- mwp[oo, ]\n  \n  # after set to 1 for year rolling year i\n  df$after &lt;- NA\n  df$after[df$year == i] &lt;- 1 \n  \n  # control year\n  if(i &lt; t){\n    # if i is still before actual treatment, compare to previous year\n    tc &lt;- i - 1\n  }else{\n    # if i is beyond actual treatment, compare to year before actual treatment (t-1)\n    tc &lt;- t - 1\n  }\n  df$after[df$year == tc] &lt;- 0\n  \n  # Restrict to the two years we want to compare\n  df &lt;- df[!is.na(df$after), ]\n  \n  # Define treated group\n  df$treat &lt;- ifelse(df$treat_timing == t, 1, 0)\n  \n  # Estiamte 2x2 DD\n  tmp.lm &lt;- lm(lnw ~ treat*after, data = df)\n  \n  # Print\n  print(paste0(i, \": \", round(tmp.lm$coefficients[4], 4)))\n}\n\n[1] \"1980: -0.1289\"\n[1] \"1981: 0.049\"\n[1] \"1982: 0.1016\"\n[1] \"1983: -0.0413\"\n[1] \"1984: 0.0303\"\n[1] \"1985: -0.07\"\n[1] \"1986: -0.1021\"\n[1] \"1987: -0.0572\"\n[1] \"1988: -0.0552\"\n[1] \"1989: -0.1644\"\n[1] \"1990: -0.131\"\n[1] \"1991: -0.229\"\n[1] \"1992: -0.0732\"\n[1] \"1993: 0.0749\"\n[1] \"1994: -0.1662\"\n[1] \"1996: NA\"\n[1] \"1998: NA\"\n[1] \"2000: NA\""
  },
  {
    "objectID": "03_Estimators2.html#differences-between-estimators",
    "href": "03_Estimators2.html#differences-between-estimators",
    "title": "Panel Data Estimators 2",
    "section": "Differences between estimators",
    "text": "Differences between estimators\nSeveral authors have proposed different dynamic DIf-in-Diff estimators (Callaway and Sant’Anna 2021; De Chaisemartin and D’Haultfœuille 2020; Borusyak, Jaravel, and Spiess 2023; Sun and Abraham 2021; Wooldridge 2021). Broadly there are:\n\nDisaggregation based estimators\nImputation based estimators"
  },
  {
    "objectID": "03_Estimators2.html#disaggregation-based-estimators",
    "href": "03_Estimators2.html#disaggregation-based-estimators",
    "title": "Panel Data Estimators 2",
    "section": "Disaggregation based estimators",
    "text": "Disaggregation based estimators\nThe Sun and Abraham (2021) estimator calculates the cohort-specific average treatment effect on the treated \\(CATT_{e,\\ell}\\) for \\(\\ell\\) periods from the initial treatment and for the cohort of units first treated at time \\(e\\). These cohort-specific and time-specific estimates are the average based on their sample weights.\nThe algorithm\n\nEstimate \\(CATT_{e,\\ell}\\) with a two-way fixed effects estimator that interacts the cohort and relative period indicators\n\n\\[\nY_{i,t}  =\\alpha_{i}+\\lambda_{t}+\\sum_{e\\not\\in C}\\sum_{\\ell\\neq-1}\\delta_{e,\\ell}(\\mathbf{1}\\{E_{i}=e\\}\\cdot D_{i,t}^{\\ell})+\\epsilon_{i,t}.\n\\]\nThe control group cohort \\(C\\) can either be the never-treated, or (if they don’t exist), Sun and Abraham (2021) propose to use the latest-treated cohort as control group. By default, the reference period is the relative period before the treatment \\(\\ell=-1\\).\n\nCalculate the sample weights of the cohort within each relative time period \\(Pr\\{E_{i}=e\\mid E_{i}\\in[-\\ell,T-\\ell]\\}\\)\nUse the estimated coefficients from step 1) \\(\\widehat{\\delta}_{e,\\ell}\\) and the estimated weights from step 2) \\(\\widehat{Pr}\\{E_{i}=e\\mid E_{i}\\in[-\\ell,T-\\ell]\\}\\) to calculate the interaction-weighted estimator \\(\\widehat{\\nu}_{g}\\):\n\n\\[\n\\widehat{\\nu}_{g}=\\frac{1}{\\left|g\\right|}\\sum_{\\ell\\in g}\\sum_{e}\\widehat{\\delta}_{e,\\ell}\\widehat{Pr}\\{E_{i}=e\\mid E_{i}\\in[-\\ell,T-\\ell]\\}\n\\]\nThis is similar to a ‘parametric’ (although very flexible) version of Callaway and Sant’Anna (2021)."
  },
  {
    "objectID": "03_Estimators2.html#imputation-based-methods",
    "href": "03_Estimators2.html#imputation-based-methods",
    "title": "Panel Data Estimators 2",
    "section": "Imputation based methods",
    "text": "Imputation based methods\n\\[\nY_{N\\times T}=\\left(\n\\begin{array}{ccccccr}\n\\checkmark & \\checkmark & \\checkmark & \\checkmark  & \\dots & \\checkmark & {\\rm (never\\ adopter)}\\\\\n\\checkmark & \\checkmark & \\checkmark & \\checkmark   & \\dots & {\\color{red} ?}  & {\\rm (late\\ adopter)}\\\\\n\\checkmark & \\checkmark & \\checkmark & \\checkmark   & \\dots & {\\color{red} ?}  \\\\\n\\checkmark & \\checkmark &{\\color{red} ?} & {\\color{red} ?}   & \\dots & {\\color{red} ?}  \\\\\n\\checkmark & \\checkmark & {\\color{red} ?} & {\\color{red} ?}   & \\dots & {\\color{red} ?} &\\ \\ \\  {\\rm (medium\\ adopter)} \\\\\n\\vdots   &  \\vdots   & \\vdots & \\vdots &\\ddots &\\vdots \\\\\n\\checkmark & {\\color{red} ?} & {\\color{red} ?} & {\\color{red} ?} & \\dots & {\\color{red} ?} & {\\rm (early\\ adopter)}  \\\\\n\\end{array}\n\\right)\n\\]\nFor more see Golub Capital Social Impact Lab ML Tutorial and Athey et al. (2021)."
  },
  {
    "objectID": "03_Estimators2.html#interactive-factor-models",
    "href": "03_Estimators2.html#interactive-factor-models",
    "title": "Panel Data Estimators 2",
    "section": "Interactive Factor Models",
    "text": "Interactive Factor Models\nGeneralized Fixed Effects (Interactive Fixed Effects, Factor Models):\n\\[\nY_{it} = \\sum_{r=1}^R \\gamma_{ir} \\delta_{tr} + \\epsilon_{it} \\quad \\text{or} \\quad,\n\\mathbf{Y} = \\mathbf U \\mathbf V^\\mathrm T + \\mathbf{\\varepsilon}.\n\\]\n\nwith with \\(\\mathbf U\\) being an \\(N \\times r\\) matrix of unknown factor loadings (unit-specific intercepts),\nand \\(\\mathbf V\\) an \\(T \\times r\\) matrix of unobserved common factors (time-varying coefficients).\n\nEstimate \\(\\\\delta\\) and \\(\\\\gamma\\) by least squares and use to impute missing values.\n\\[\n\\hat Y _{NT} = \\sum_{r=1}^R \\hat \\delta_{Nr} \\hat \\gamma_{rT}.\n\\]\nIn a matrix form, the \\(Y_{N \\times T}\\) can be rewritten as:\n\\[\nY_{N\\times T}= \\mathbf U \\mathbf V^\\mathrm T + \\epsilon_{N \\times T} =  \\mathbf L_{N \\times T} + \\epsilon_{N \\times T} = \\\\ \\left(\n\\begin{array}{ccccccc}\n\\delta_{11} & \\dots & \\delta_{R1}  \\\\\n\\vdots & \\dots & \\vdots   \\\\\n\\vdots & \\dots & \\vdots   \\\\\n\\vdots & \\dots & \\vdots   \\\\\n\\delta_{1N} & \\dots & \\delta_{RN}  \\\\\n\\end{array}\\right)\n\\left(\n\\begin{array}{ccccccc}\n\\gamma_{11}  & \\dots \\dots \\dots & \\gamma_{1T}  \\\\\n\\vdots & \\dots \\dots \\dots & \\vdots   \\\\\n\\gamma_{R1}  & \\dots \\dots \\dots & \\gamma_{RT}  \\\\\n\\end{array}\n\\right) + \\epsilon_{N \\times T}\n\\]"
  },
  {
    "objectID": "03_Estimators2.html#borusyak-did-imputation",
    "href": "03_Estimators2.html#borusyak-did-imputation",
    "title": "Panel Data Estimators 2",
    "section": "Borusyak DiD imputation",
    "text": "Borusyak DiD imputation\nWe start with the assumption that we can write the underlying model as:\n\\[\nY_{it} = A_{it}^{'}\\lambda_i + X_{it}^{'}\\delta + D_{it}^{'}\\Gamma_{it}^{'}\\theta + \\varepsilon_{it}  \n\\]\n\nwhere \\(A_{it}^{'}\\lambda_i\\) contains unit FEs, but also allows to interact them with some observed covariates unaffected by the treatment status\nand \\(X_{it}^{'}\\delta\\) nests period FEs but additionally allows any time-varying covariates,\n\\(\\lambda_i\\) is a vector of unit-specific nuisance parameters,\nand \\(\\delta\\) is a vector of nuisance parameters associated with common covariates.\n\nThe algorithm\n\nFor every treated observation, estimate expected untreated potential outcomes \\(A_{it}^{'}\\lambda_i + X_{it}^{'}\\delta\\) by some unbiased linear estimator \\(\\hat Y_{it}(0)\\) using data from the untreated observations only,\nFor each treated observation (\\(\\in\\Omega_1\\)), set \\(\\hat\\tau_{it} = Y_{it} - \\hat{Y}_{it}(0)\\),\nEstimate the target by a weighted sum \\(\\hat\\tau = \\sum_{it\\in\\Omega_1}w_{it}\\hat\\tau_{it}\\).\n\nSee Borusyak, Jaravel, and Spiess (2021).\nNote that this uses all pre-treatment periods (also those further away) for imputation of the counterfactual."
  },
  {
    "objectID": "03_Estimators2.html#differences",
    "href": "03_Estimators2.html#differences",
    "title": "Panel Data Estimators 2",
    "section": "Differences",
    "text": "Differences\n\nRüttenauer and Aksoy (2024)"
  },
  {
    "objectID": "03_Estimators2.html#differences-1",
    "href": "03_Estimators2.html#differences-1",
    "title": "Panel Data Estimators 2",
    "section": "Differences",
    "text": "Differences\n\nRüttenauer and Aksoy (2024)"
  },
  {
    "objectID": "03_Estimators2.html#example-2-marriage-and-satisfaction-with-sex-life",
    "href": "03_Estimators2.html#example-2-marriage-and-satisfaction-with-sex-life",
    "title": "Panel Data Estimators 2",
    "section": "Example 2: Marriage and satisfaction with sex life",
    "text": "Example 2: Marriage and satisfaction with sex life\nWe use 13 waves of panel data from the Panel Analysis of Intimate Relationships and Family Dynamics (pairfam) survey, release 14.1 (Brüderl et al. 2023), to examine how the transition into first marriage is associated with changes in respondents’ sexual satisfaction.\nSee Rüttenauer and Kapelle (2024) for more information"
  },
  {
    "objectID": "03_Estimators2.html#example-2-marriage-and-satisfaction-with-sex-life-1",
    "href": "03_Estimators2.html#example-2-marriage-and-satisfaction-with-sex-life-1",
    "title": "Panel Data Estimators 2",
    "section": "Example 2: Marriage and satisfaction with sex life",
    "text": "Example 2: Marriage and satisfaction with sex life\n\nExample from Rüttenauer and Kapelle (2024)"
  },
  {
    "objectID": "03_Estimators2.html#example-2-marriage-and-satisfaction-with-sex-life-2",
    "href": "03_Estimators2.html#example-2-marriage-and-satisfaction-with-sex-life-2",
    "title": "Panel Data Estimators 2",
    "section": "Example 2: Marriage and satisfaction with sex life",
    "text": "Example 2: Marriage and satisfaction with sex life\n\nExample from Rüttenauer and Kapelle (2024)"
  },
  {
    "objectID": "03_Estimators2.html#parallel-trends",
    "href": "03_Estimators2.html#parallel-trends",
    "title": "Panel Data Estimators 2",
    "section": "Parallel trends",
    "text": "Parallel trends\nRemember that we have to make the parallel trends assumption in twoways FE models. A violation of the parallel trends assumption leads to biased estimates.\nUsually, when controlling for time fixed effects, we make the assumption that every observation experiences the same “effect of time”.\nHowever, we can relax this assumption by giving each individual their own intercept and their own slope."
  },
  {
    "objectID": "03_Estimators2.html#fixed-effects-individual-slopes-1",
    "href": "03_Estimators2.html#fixed-effects-individual-slopes-1",
    "title": "Panel Data Estimators 2",
    "section": "Fixed Effects Individual Slopes",
    "text": "Fixed Effects Individual Slopes\nThe FEIS estimator\n\\[\ny_{it} = \\beta x_{it} + \\alpha_i + \\alpha_i*w_{it} + \\zeta_t + \\epsilon_{it},\n\\] includes the person-fixed effects \\(\\alpha_i\\), and an interaction between person-fixed effects \\(\\alpha_i\\) and another time-varying variable \\(w_{it}\\), which often is a function of time.\nIf time-fixed effects \\(\\zeta_t\\) can be included, depends on the specification of \\(w_{it}\\)."
  },
  {
    "objectID": "03_Estimators2.html#fixed-effects-individual-slopes-2",
    "href": "03_Estimators2.html#fixed-effects-individual-slopes-2",
    "title": "Panel Data Estimators 2",
    "section": "Fixed Effects Individual Slopes",
    "text": "Fixed Effects Individual Slopes\nAs with the conventional FE, FEIS can be estimated using lm() by including \\(N-1\\) individual-specific dummies and interaction terms of each slope variable with the \\(N-1\\) individual-specific dummies (\\((N-1) *J\\) controls).\nThis is however highly inefficient."
  },
  {
    "objectID": "03_Estimators2.html#fixed-effects-individual-slopes-3",
    "href": "03_Estimators2.html#fixed-effects-individual-slopes-3",
    "title": "Panel Data Estimators 2",
    "section": "Fixed Effects Individual Slopes",
    "text": "Fixed Effects Individual Slopes\nwe can achieve the same result by running an lm() on pre-transformed data. Therefore, specify the ‘residual maker’ matrix \\(\\boldsymbol{\\mathbf{M}}_i = \\boldsymbol{\\mathbf{I}}_T - \\boldsymbol{\\mathbf{W}}_i(\\boldsymbol{\\mathbf{W}}^\\intercal_i \\boldsymbol{\\mathbf{W}}_i)^{-1}\\boldsymbol{\\mathbf{W}}^\\intercal_i\\), and estimate\n\\[\n\\begin{align}\ny_{it} - \\hat{y}_{it} =& (\\boldsymbol{\\mathbf{x}}_{it} - \\hat{\\boldsymbol{\\mathbf{x}}}_{it})\\boldsymbol{\\mathbf{\\beta }}+ \\epsilon_{it} - \\hat{\\epsilon}_{it}, \\\\\n\\boldsymbol{\\mathbf{M}}_i \\boldsymbol{\\mathbf{y}}_i =& \\boldsymbol{\\mathbf{M}}_i \\boldsymbol{\\mathbf{X}}_i\\boldsymbol{\\mathbf{\\beta }}+ \\boldsymbol{\\mathbf{M}}_i \\boldsymbol{\\mathbf{\\epsilon}}_{i}, \\\\\n\\tilde{\\boldsymbol{\\mathbf{y}}}_{i} =& \\tilde{\\boldsymbol{\\mathbf{X}}}_{i}\\boldsymbol{\\mathbf{\\beta }}+ \\tilde{\\boldsymbol{\\mathbf{\\epsilon}}}_{i},\n\\end{align}\n\\]\nwhere \\(\\tilde{\\boldsymbol{\\mathbf{y}}}_{i}\\), \\(\\tilde{\\boldsymbol{\\mathbf{X}}}_{i}\\), and \\(\\tilde{\\boldsymbol{\\mathbf{\\epsilon}}}_{i}\\) are the residuals of regressing \\(\\boldsymbol{\\mathbf{y}}_{i}\\), each column-vector of \\(\\boldsymbol{\\mathbf{X}}_{i}\\), and \\(\\boldsymbol{\\mathbf{\\epsilon}}_{i}\\) on \\(\\boldsymbol{\\mathbf{W}}_i\\)."
  },
  {
    "objectID": "03_Estimators2.html#feis-intuitively",
    "href": "03_Estimators2.html#feis-intuitively",
    "title": "Panel Data Estimators 2",
    "section": "FEIS intuitively",
    "text": "FEIS intuitively\n\nestimate the individual-specific predicted values for the dependent variable and each covariate based on an individual intercept and the additional slope variables of \\(\\boldsymbol{\\mathbf{W}}_i\\),\n‘detrend’ the original data by these individual-specific predicted values, and\nrun an OLS model on the residual (‘detrended’) data."
  },
  {
    "objectID": "03_Estimators2.html#feis-mundlak",
    "href": "03_Estimators2.html#feis-mundlak",
    "title": "Panel Data Estimators 2",
    "section": "FEIS Mundlak",
    "text": "FEIS Mundlak\nSimilarly, we can estimate a correlated random effects (CRE) model (Chamberlain 1982; Mundlak 1978; Wooldridge 2010) including the individual specific predictions \\(\\hat{\\boldsymbol{\\mathbf{X}}}_{i}\\) to obtain the FEIS estimator:\n\\[\n\\begin{align}\n\\boldsymbol{\\mathbf{y}}_{i} =& \\boldsymbol{\\mathbf{X}}_{i}\\boldsymbol{\\mathbf{\\beta }}+ \\hat{\\boldsymbol{\\mathbf{X}}}_{i}\\boldsymbol{\\mathbf{\\rho }}+ \\boldsymbol{\\mathbf{\\epsilon}}_{i}.\n\\end{align}\n\\]\nIt does not necessarily be time or person-specific. You could also control for family-specific pre-treatment conditions or regional time-trends (Rüttenauer and Ludwig 2023)."
  },
  {
    "objectID": "03_Estimators2.html#example",
    "href": "03_Estimators2.html#example",
    "title": "Panel Data Estimators 2",
    "section": "Example",
    "text": "Example\nAs an example, we use the mwp panel data, containing information on wages and family status of 268 men.\nWe exemplary investigate the ‘marriage wage premium’: we analyse whether marriage leads to an increase in the hourly wage for men."
  },
  {
    "objectID": "03_Estimators2.html#example-1",
    "href": "03_Estimators2.html#example-1",
    "title": "Panel Data Estimators 2",
    "section": "Example",
    "text": "Example\n\nlibrary(feisr)\ndata(\"mwp\", package = \"feisr\")\nhead(mwp)\n\n  id year      lnw      exp      expq marry evermarry enrol yeduc age cohort\n1  1 1981 1.934358 1.076923  1.159763     0         1     1    11  18   1963\n2  1 1983 2.468140 3.019231  9.115755     0         1     1    12  20   1963\n3  1 1984 2.162480 4.038462 16.309174     0         1     1    12  21   1963\n4  1 1985 1.746280 5.076923 25.775146     0         1     0    12  22   1963\n5  1 1986 2.527840 6.096154 37.163090     0         1     1    13  23   1963\n6  1 1987 2.365361 7.500000 56.250000     0         1     1    13  24   1963\n  yeargr yeargr1 yeargr2 yeargr3 yeargr4 yeargr5\n1      2       0       1       0       0       0\n2      2       0       1       0       0       0\n3      2       0       1       0       0       0\n4      2       0       1       0       0       0\n5      3       0       0       1       0       0\n6      3       0       0       1       0       0"
  },
  {
    "objectID": "03_Estimators2.html#example-2",
    "href": "03_Estimators2.html#example-2",
    "title": "Panel Data Estimators 2",
    "section": "Example",
    "text": "Example\n\nwages.fe &lt;- plm(lnw ~ marry + enrol + yeduc + as.factor(yeargr)\n                + exp + I(exp^2), \n                data = mwp, index = c(\"id\", \"year\"),\n                model = \"within\", effect = \"individual\")\nwages.re &lt;- plm(lnw ~ marry + enrol + yeduc + as.factor(yeargr)\n                + exp + I(exp^2), \n                data = mwp, index = c(\"id\", \"year\"),\n                model = \"random\", effect = \"individual\")"
  },
  {
    "objectID": "03_Estimators2.html#example-3",
    "href": "03_Estimators2.html#example-3",
    "title": "Panel Data Estimators 2",
    "section": "Example",
    "text": "Example\n\nwages.fe &lt;- plm(lnw ~ marry + enrol + yeduc + as.factor(yeargr)\n                + exp + I(exp^2), \n                data = mwp, index = c(\"id\", \"year\"),\n                model = \"within\", effect = \"individual\")\nwages.re &lt;- plm(lnw ~ marry + enrol + yeduc + as.factor(yeargr)\n                + exp + I(exp^2), \n                data = mwp, index = c(\"id\", \"year\"),\n                model = \"random\", effect = \"individual\")"
  },
  {
    "objectID": "03_Estimators2.html#cluster-robust-ses",
    "href": "03_Estimators2.html#cluster-robust-ses",
    "title": "Panel Data Estimators 2",
    "section": "Cluster robust SEs",
    "text": "Cluster robust SEs\n\n# Calculate vcov\nvcovx_fe &lt;- vcovHC(wages.fe, cluster = \"group\", method = \"arellano\", type = \"HC3\")\nvcovx_re &lt;- vcovHC(wages.re, cluster = \"group\", method = \"arellano\", type = \"HC3\")\n\n# Replace original vcov in output\nwages.fe$vcov &lt;- vcovx_fe\nwages.re$vcov &lt;- vcovx_re"
  },
  {
    "objectID": "03_Estimators2.html#cluster-robust-ses-1",
    "href": "03_Estimators2.html#cluster-robust-ses-1",
    "title": "Panel Data Estimators 2",
    "section": "Cluster robust SEs",
    "text": "Cluster robust SEs\n\n# Calculate vcov\nvcovx_fe &lt;- vcovHC(wages.fe, cluster = \"group\", method = \"arellano\", type = \"HC3\")\nvcovx_re &lt;- vcovHC(wages.re, cluster = \"group\", method = \"arellano\", type = \"HC3\")\n\n# Replace original vcov in output\nwages.fe$vcov &lt;- vcovx_fe\nwages.re$vcov &lt;- vcovx_re"
  },
  {
    "objectID": "03_Estimators2.html#feis",
    "href": "03_Estimators2.html#feis",
    "title": "Panel Data Estimators 2",
    "section": "FEIS",
    "text": "FEIS\n\nwages.feis &lt;- feis(lnw ~ marry + enrol + yeduc + as.factor(yeargr)\n                   | exp + I(exp^2), \n                   data = mwp, id = \"id\",\n                   robust = TRUE)\nsummary(wages.feis)"
  },
  {
    "objectID": "03_Estimators2.html#feis-1",
    "href": "03_Estimators2.html#feis-1",
    "title": "Panel Data Estimators 2",
    "section": "FEIS",
    "text": "FEIS\n\nwages.feis &lt;- feis(lnw ~ marry + enrol + yeduc + as.factor(yeargr)\n                   | exp + I(exp^2), \n                   data = mwp, id = \"id\",\n                   robust = TRUE)\nsummary(wages.feis)"
  },
  {
    "objectID": "03_Estimators2.html#feis-2",
    "href": "03_Estimators2.html#feis-2",
    "title": "Panel Data Estimators 2",
    "section": "FEIS",
    "text": "FEIS\n\nwages.feis &lt;- feis(lnw ~ marry + enrol + yeduc + as.factor(yeargr)\n                   | exp + I(exp^2), \n                   data = mwp, id = \"id\",\n                   robust = TRUE)\nsummary(wages.feis)\n\n\n\nCall:\nfeis(formula = lnw ~ marry + enrol + yeduc + as.factor(yeargr) | \n    exp + I(exp^2), data = mwp, id = \"id\", robust = TRUE)\n\n\nResiduals:\n      Min.    1st Qu.     Median    3rd Qu.       Max. \n-2.0790815 -0.1050450  0.0046876  0.1112708  1.9412090 \n\nCoefficients:\n                     Estimate Std. Error t-value  Pr(&gt;|t|)    \nmarry               0.0134582  0.0292771  0.4597   0.64579    \nenrol              -0.1181725  0.0235003 -5.0286 5.325e-07 ***\nyeduc              -0.0020607  0.0175059 -0.1177   0.90630    \nas.factor(yeargr)2 -0.0464504  0.0378675 -1.2267   0.22008    \nas.factor(yeargr)3 -0.0189333  0.0524265 -0.3611   0.71803    \nas.factor(yeargr)4 -0.1361305  0.0615033 -2.2134   0.02697 *  \nas.factor(yeargr)5 -0.1868589  0.0742904 -2.5152   0.01196 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCluster robust standard errors\nSlope parameters:  exp, I(exp^2) \nTotal Sum of Squares:    190.33\nResidual Sum of Squares: 185.64\nR-Squared:      0.024626\nAdj. R-Squared: 0.022419"
  },
  {
    "objectID": "03_Estimators2.html#comparison",
    "href": "03_Estimators2.html#comparison",
    "title": "Panel Data Estimators 2",
    "section": "Comparison",
    "text": "Comparison\n\nscreenreg(list(wages.re, wages.fe, wages.feis), digits = 3,\n          custom.model.names = c(\"RE\", \"FE\", \"FEIS\"))\n\n\n============================================================\n                    RE            FE            FEIS        \n------------------------------------------------------------\n(Intercept)            1.562 ***                            \n                      (0.094)                               \nmarry                  0.091 **      0.078 *       0.013    \n                      (0.032)       (0.032)       (0.029)   \nenrol                 -0.202 ***    -0.208 ***    -0.118 ***\n                      (0.025)       (0.027)       (0.024)   \nyeduc                  0.063 ***     0.056 ***    -0.002    \n                      (0.008)       (0.010)       (0.018)   \nas.factor(yeargr)2    -0.157 ***    -0.141 ***    -0.046    \n                      (0.034)       (0.036)       (0.038)   \nas.factor(yeargr)3    -0.197 ***    -0.165 **     -0.019    \n                      (0.050)       (0.053)       (0.052)   \nas.factor(yeargr)4    -0.316 ***    -0.276 ***    -0.136 *  \n                      (0.066)       (0.068)       (0.062)   \nas.factor(yeargr)5    -0.349 ***    -0.298 ***    -0.187 *  \n                      (0.089)       (0.089)       (0.074)   \nexp                    0.074 ***     0.073 ***              \n                      (0.012)       (0.012)                 \nexp^2                 -0.001 *      -0.001 *                \n                      (0.001)       (0.001)                 \n------------------------------------------------------------\ns_idios                0.341                                \ns_id                   0.279                                \nR^2                    0.440         0.414         0.025    \nAdj. R^2               0.439         0.357         0.022    \nNum. obs.           3100          3100          3100        \nNum. groups: id                                  268        \nRMSE                                               0.285    \n============================================================\n*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05"
  },
  {
    "objectID": "03_Estimators2.html#interpretation",
    "href": "03_Estimators2.html#interpretation",
    "title": "Panel Data Estimators 2",
    "section": "Interpretation",
    "text": "Interpretation\n\nRE: Married observations have a significantly higher wage than unmarried observations.\nFE: If people marry, they experience an increase in wages afterwards. The effect is significant and slightly lower than the RE.\nFEIS: Accounting for the individual wage trend before marriage, we do not observe an increase in wages if people marry. The effect is small and non-significant.\n\nOverall, this indicates that there is a problem with non-parallel trends: Those with steeper wage trajectories are more likely to marry (or marry earlier).\nAs mentioned above, we can achieve the same by 1) manually calculating the individual specific trends and 2) including them as additional covariates in the model."
  },
  {
    "objectID": "03_Estimators2.html#the-biggest-limitations",
    "href": "03_Estimators2.html#the-biggest-limitations",
    "title": "Panel Data Estimators 2",
    "section": "The biggest limitations",
    "text": "The biggest limitations\n\nIt is crucial to model the trends correctly\nYou need \\(k+1\\) time-periods per unit to estimate the trend based on \\(k\\) variables (related to selection?)\nWith dynamic treatment effects (which are not specified in your model), the individual trends may absorb the unfolding treatment effect"
  },
  {
    "objectID": "03_Estimators2.html#references",
    "href": "03_Estimators2.html#references",
    "title": "Panel Data Estimators 2",
    "section": "References",
    "text": "References\n\n\n&lt;Home&gt;\n\n\n\nAthey, Susan, Mohsen Bayati, Nikolay Doudchenko, Guido Imbens, and Khashayar Khosravi. 2021. “Matrix Completion Methods for Causal Panel Data Models.” Journal of the American Statistical Association 59: 1–15. https://doi.org/10.1080/01621459.2021.1891924.\n\n\nBorusyak, Kirill, Xavier Jaravel, and Jann Spiess. 2021. “Revisiting Event Study Designs: Robust and Efficient Estimation.” https://doi.org/10.48550/ARXIV.2108.12419.\n\n\n———. 2023. “Revisiting Event Study Designs: Robust and Efficient Estimation.” https://doi.org/10.48550/ARXIV.2108.12419.\n\n\nBrüderl, Josef, Sonja Drobnič, Karsten Hank, Franz. J. Neyer, Sabine Walper, Christof Wolf, Philipp Alt, et al. 2023. “The German Family Panel (pairfam)Beziehungs- und Familienpanel (pairfam).” https://doi.org/10.4232/PAIRFAM.5678.14.1.0.\n\n\nCallaway, Brantly, and Pedro H. C. Sant’Anna. 2021. “Difference-in-Differences with Multiple Time Periods.” Journal of Econometrics 225 (2): 200–230. https://doi.org/10.1016/j.jeconom.2020.12.001.\n\n\nChamberlain, Gary. 1982. “Multivariate Regression Models for Panel Data.” Journal of Econometrics 18 (1): 5–46. https://doi.org/10.1016/0304-4076(82)90094-X.\n\n\nClark, Andrew E., and Yannis Georgellis. 2013. “Back to Baseline in Britain: Adaptation in the British Household Panel Survey.” Economica 80 (319): 496–512. https://doi.org/10.1111/ecca.12007.\n\n\nCunningham, Scott. 2021. Causal Inference: The Mixtape. New Haven and London: Yale University Press.\n\n\nDe Chaisemartin, Clément, and Xavier D’Haultfœuille. 2020. “Two-Way Fixed Effects Estimators with Heterogeneous Treatment Effects.” American Economic Review 110 (9): 2964–96. https://doi.org/10.1257/aer.20181169.\n\n\nGoodman-Bacon, Andrew. 2021. “Difference-in-Differences with Variation in Treatment Timing.” Journal of Econometrics 225 (2): 254–77. https://doi.org/10.1016/j.jeconom.2021.03.014.\n\n\nLudwig, Volker, and Josef Brüderl. 2021. “What You Need to Know When Estimating Impact Functions with Panel Data for Demographic Research.” Comparative Population Studies 46. https://doi.org/10.12765/CPoS-2021-16.\n\n\nMundlak, Yair. 1978. “On the Pooling of Time Series and Cross Section Data.” Econometrica 46 (1): 69. https://doi.org/10.2307/1913646.\n\n\nRoth, Jonathan, Pedro H. C. Sant’Anna, Alyssa Bilinski, and John Poe. 2023. “What’s Trending in Difference-in-Differences? A Synthesis of the Recent Econometrics Literature.” Journal of Econometrics 235 (2): 2218–44. https://doi.org/10.1016/j.jeconom.2023.03.008.\n\n\nRüttenauer, Tobias, and Ozan Aksoy. 2024. “When Can We Use Two-Way Fixed-Effects (TWFE): A Comparison of TWFE and Novel Dynamic Difference-in-Differences Estimators.” Preprint. SocArXiv. https://doi.org/10.31235/osf.io/cpvzf.\n\n\nRüttenauer, Tobias, and Henning Best. 2021. “Environmental Inequality and Residential Sorting in Germany: A Spatial Time-Series Analysis of the Demographic Consequences of Industrial Sites.” Demography 58 (6): 2243–63. https://doi.org/10.1215/00703370-9563077.\n\n\nRüttenauer, Tobias, and Nicole Kapelle. 2024. “Panel Data Analysis.” https://doi.org/10.31235/osf.io/3mfzq.\n\n\nRüttenauer, Tobias, and Volker Ludwig. 2023. “Fixed Effects Individual Slopes: Accounting and Testing for Heterogeneous Effects in Panel Data or Other Multilevel Models.” Sociological Methods & Research 52 (1): 43–84. https://doi.org/10.1177/0049124120926211.\n\n\nSun, Liyang, and Sarah Abraham. 2021. “Estimating Dynamic Treatment Effects in Event Studies with Heterogeneous Treatment Effects.” Journal of Econometrics 225 (2): 175–99. https://doi.org/10.1016/j.jeconom.2020.09.006.\n\n\nWooldridge, Jeffrey M. 2010. Econometric Analysis of Cross Section and Panel Data. Cambridge, Mass.: MIT Press.\n\n\n———. 2021. “Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Differences Estimators.” SSRN Electronic Journal. https://doi.org/10.2139/ssrn.3906345.\n\n\nZoch, Gundula, and Stefanie Heyne. 2023. “The Evolution of Family Policies and Couples’ Housework Division After Childbirth in Germany, 1994.” Journal of Marriage and Family 85 (5): 1067–86. https://doi.org/10.1111/jomf.12938."
  }
]